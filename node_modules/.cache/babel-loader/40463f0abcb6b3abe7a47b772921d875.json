{"ast":null,"code":"import{useTransactionMonitoringEventCallback}from'hooks/useMonitoringEventCallback';import{useCallback,useMemo}from'react';import{useAppDispatch,useAppSelector}from'state/hooks';import{useActiveWeb3React}from'../../hooks/web3';import{addTransaction,TransactionType}from'./actions';// helper that can take a ethers library transaction response and add it to the list of transactions\nexport function useTransactionAdder(){var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId,account=_useActiveWeb3React.account;var dispatch=useAppDispatch();var logMonitoringEvent=useTransactionMonitoringEventCallback();return useCallback(function(response,info){if(!account)return;if(!chainId)return;var hash=response.hash;if(!hash){throw Error('No transaction hash found.');}dispatch(addTransaction({hash:hash,from:account,info:info,chainId:chainId}));logMonitoringEvent(info,response);},[account,chainId,dispatch,logMonitoringEvent]);}// returns all the transactions for the current chain\nexport function useAllTransactions(){var _state$chainId;var _useActiveWeb3React2=useActiveWeb3React(),chainId=_useActiveWeb3React2.chainId;var state=useAppSelector(function(state){return state.transactions;});return chainId?(_state$chainId=state[chainId])!==null&&_state$chainId!==void 0?_state$chainId:{}:{};}export function useTransaction(transactionHash){var allTransactions=useAllTransactions();if(!transactionHash){return undefined;}return allTransactions[transactionHash];}export function useIsTransactionPending(transactionHash){var transactions=useAllTransactions();if(!transactionHash||!transactions[transactionHash])return false;return!transactions[transactionHash].receipt;}export function useIsTransactionConfirmed(transactionHash){var transactions=useAllTransactions();if(!transactionHash||!transactions[transactionHash])return false;return Boolean(transactions[transactionHash].receipt);}/**\n * Returns whether a transaction happened in the last day (86400 seconds * 1000 milliseconds / second)\n * @param tx to check for recency\n */export function isTransactionRecent(tx){return new Date().getTime()-tx.addedTime<86400000;}// returns whether a token has a pending approval transaction\nexport function useHasPendingApproval(tokenAddress,spender){var allTransactions=useAllTransactions();return useMemo(function(){return typeof tokenAddress==='string'&&typeof spender==='string'&&Object.keys(allTransactions).some(function(hash){var tx=allTransactions[hash];if(!tx)return false;if(tx.receipt){return false;}else{if(tx.info.type!==TransactionType.APPROVAL)return false;return tx.info.spender===spender&&tx.info.tokenAddress===tokenAddress&&isTransactionRecent(tx);}});},[allTransactions,spender,tokenAddress]);}// watch for submissions to claim\n// return null if not done loading, return undefined if not found\nexport function useUserHasSubmittedClaim(account){var allTransactions=useAllTransactions();// get the txn if it has been submitted\nvar claimTxn=useMemo(function(){var txnIndex=Object.keys(allTransactions).find(function(hash){var tx=allTransactions[hash];return tx.info.type===TransactionType.CLAIM&&tx.info.recipient===account;});return txnIndex&&allTransactions[txnIndex]?allTransactions[txnIndex]:undefined;},[account,allTransactions]);return{claimSubmitted:Boolean(claimTxn),claimTxn:claimTxn};}","map":{"version":3,"sources":["/Users/safahi/Downloads/interface-4.30.1/src/state/transactions/hooks.tsx"],"names":["useTransactionMonitoringEventCallback","useCallback","useMemo","useAppDispatch","useAppSelector","useActiveWeb3React","addTransaction","TransactionType","useTransactionAdder","chainId","account","dispatch","logMonitoringEvent","response","info","hash","Error","from","useAllTransactions","state","transactions","useTransaction","transactionHash","allTransactions","undefined","useIsTransactionPending","receipt","useIsTransactionConfirmed","Boolean","isTransactionRecent","tx","Date","getTime","addedTime","useHasPendingApproval","tokenAddress","spender","Object","keys","some","type","APPROVAL","useUserHasSubmittedClaim","claimTxn","txnIndex","find","CLAIM","recipient","claimSubmitted"],"mappings":"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","sourcesContent":["import { TransactionResponse } from '@ethersproject/providers'\nimport { useTransactionMonitoringEventCallback } from 'hooks/useMonitoringEventCallback'\nimport { useCallback, useMemo } from 'react'\nimport { useAppDispatch, useAppSelector } from 'state/hooks'\n\nimport { useActiveWeb3React } from '../../hooks/web3'\nimport { addTransaction, TransactionInfo, TransactionType } from './actions'\nimport { TransactionDetails } from './reducer'\n\n// helper that can take a ethers library transaction response and add it to the list of transactions\nexport function useTransactionAdder(): (response: TransactionResponse, info: TransactionInfo) => void {\n  const { chainId, account } = useActiveWeb3React()\n  const dispatch = useAppDispatch()\n\n  const logMonitoringEvent = useTransactionMonitoringEventCallback()\n\n  return useCallback(\n    (response: TransactionResponse, info: TransactionInfo) => {\n      if (!account) return\n      if (!chainId) return\n\n      const { hash } = response\n      if (!hash) {\n        throw Error('No transaction hash found.')\n      }\n      dispatch(addTransaction({ hash, from: account, info, chainId }))\n\n      logMonitoringEvent(info, response)\n    },\n    [account, chainId, dispatch, logMonitoringEvent]\n  )\n}\n\n// returns all the transactions for the current chain\nexport function useAllTransactions(): { [txHash: string]: TransactionDetails } {\n  const { chainId } = useActiveWeb3React()\n\n  const state = useAppSelector((state) => state.transactions)\n\n  return chainId ? state[chainId] ?? {} : {}\n}\n\nexport function useTransaction(transactionHash?: string): TransactionDetails | undefined {\n  const allTransactions = useAllTransactions()\n\n  if (!transactionHash) {\n    return undefined\n  }\n\n  return allTransactions[transactionHash]\n}\n\nexport function useIsTransactionPending(transactionHash?: string): boolean {\n  const transactions = useAllTransactions()\n\n  if (!transactionHash || !transactions[transactionHash]) return false\n\n  return !transactions[transactionHash].receipt\n}\n\nexport function useIsTransactionConfirmed(transactionHash?: string): boolean {\n  const transactions = useAllTransactions()\n\n  if (!transactionHash || !transactions[transactionHash]) return false\n\n  return Boolean(transactions[transactionHash].receipt)\n}\n\n/**\n * Returns whether a transaction happened in the last day (86400 seconds * 1000 milliseconds / second)\n * @param tx to check for recency\n */\nexport function isTransactionRecent(tx: TransactionDetails): boolean {\n  return new Date().getTime() - tx.addedTime < 86_400_000\n}\n\n// returns whether a token has a pending approval transaction\nexport function useHasPendingApproval(tokenAddress: string | undefined, spender: string | undefined): boolean {\n  const allTransactions = useAllTransactions()\n  return useMemo(\n    () =>\n      typeof tokenAddress === 'string' &&\n      typeof spender === 'string' &&\n      Object.keys(allTransactions).some((hash) => {\n        const tx = allTransactions[hash]\n        if (!tx) return false\n        if (tx.receipt) {\n          return false\n        } else {\n          if (tx.info.type !== TransactionType.APPROVAL) return false\n          return tx.info.spender === spender && tx.info.tokenAddress === tokenAddress && isTransactionRecent(tx)\n        }\n      }),\n    [allTransactions, spender, tokenAddress]\n  )\n}\n\n// watch for submissions to claim\n// return null if not done loading, return undefined if not found\nexport function useUserHasSubmittedClaim(account?: string): {\n  claimSubmitted: boolean\n  claimTxn: TransactionDetails | undefined\n} {\n  const allTransactions = useAllTransactions()\n\n  // get the txn if it has been submitted\n  const claimTxn = useMemo(() => {\n    const txnIndex = Object.keys(allTransactions).find((hash) => {\n      const tx = allTransactions[hash]\n      return tx.info.type === TransactionType.CLAIM && tx.info.recipient === account\n    })\n    return txnIndex && allTransactions[txnIndex] ? allTransactions[txnIndex] : undefined\n  }, [account, allTransactions])\n\n  return { claimSubmitted: Boolean(claimTxn), claimTxn }\n}\n"]},"metadata":{},"sourceType":"module"}