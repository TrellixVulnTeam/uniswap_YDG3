{"ast":null,"code":"import { log } from '../util/log';\n/**\n * Provider for getting gas price, with functionality for caching the results.\n *\n * @export\n * @class CachingV3SubgraphProvider\n */\n\nexport class CachingGasStationProvider {\n  /**\n   * Creates an instance of CachingGasStationProvider.\n   * @param chainId The chain id to use.\n   * @param gasPriceProvider The provider to use to get the gas price when not in the cache.\n   * @param cache Cache instance to hold cached pools.\n   */\n  constructor(chainId, gasPriceProvider, cache) {\n    this.chainId = chainId;\n    this.gasPriceProvider = gasPriceProvider;\n    this.cache = cache;\n\n    this.GAS_KEY = chainId => `gasPrice-${chainId}`;\n  }\n\n  async getGasPrice() {\n    const cachedGasPrice = await this.cache.get(this.GAS_KEY(this.chainId));\n\n    if (cachedGasPrice) {\n      log.info({\n        cachedGasPrice\n      }, `Got gas station price from local cache: ${cachedGasPrice.gasPriceWei}.`);\n      return cachedGasPrice;\n    }\n\n    log.info('Gas station price local cache miss.');\n    const gasPrice = await this.gasPriceProvider.getGasPrice();\n    await this.cache.set(this.GAS_KEY(this.chainId), gasPrice);\n    return gasPrice;\n  }\n\n}","map":{"version":3,"sources":["../../../../src/providers/caching-gas-provider.ts"],"names":[],"mappings":"AACA,SAAS,GAAT,QAAoB,aAApB;AAIA;;;;;AAKG;;AACH,OAAM,MAAO,yBAAP,CAAgC;AAGpC;;;;;AAKG;AACH,EAAA,WAAA,CACY,OADZ,EAEU,gBAFV,EAGU,KAHV,EAGiC;AAFrB,SAAA,OAAA,GAAA,OAAA;AACF,SAAA,gBAAA,GAAA,gBAAA;AACA,SAAA,KAAA,GAAA,KAAA;;AAXF,SAAA,OAAA,GAAW,OAAD,IAAsB,YAAY,OAAO,EAAnD;AAYJ;;AAEoB,QAAX,WAAW,GAAA;AACtB,UAAM,cAAc,GAAG,MAAM,KAAK,KAAL,CAAW,GAAX,CAAe,KAAK,OAAL,CAAa,KAAK,OAAlB,CAAf,CAA7B;;AAEA,QAAI,cAAJ,EAAoB;AAClB,MAAA,GAAG,CAAC,IAAJ,CACE;AAAE,QAAA;AAAF,OADF,EAEE,2CAA2C,cAAc,CAAC,WAAW,GAFvE;AAKA,aAAO,cAAP;AACD;;AAED,IAAA,GAAG,CAAC,IAAJ,CAAS,qCAAT;AACA,UAAM,QAAQ,GAAG,MAAM,KAAK,gBAAL,CAAsB,WAAtB,EAAvB;AACA,UAAM,KAAK,KAAL,CAAW,GAAX,CAAe,KAAK,OAAL,CAAa,KAAK,OAAlB,CAAf,EAA2C,QAA3C,CAAN;AAEA,WAAO,QAAP;AACD;;AAhCmC","sourceRoot":"","sourcesContent":["import { log } from '../util/log';\n/**\n * Provider for getting gas price, with functionality for caching the results.\n *\n * @export\n * @class CachingV3SubgraphProvider\n */\nexport class CachingGasStationProvider {\n    /**\n     * Creates an instance of CachingGasStationProvider.\n     * @param chainId The chain id to use.\n     * @param gasPriceProvider The provider to use to get the gas price when not in the cache.\n     * @param cache Cache instance to hold cached pools.\n     */\n    constructor(chainId, gasPriceProvider, cache) {\n        this.chainId = chainId;\n        this.gasPriceProvider = gasPriceProvider;\n        this.cache = cache;\n        this.GAS_KEY = (chainId) => `gasPrice-${chainId}`;\n    }\n    async getGasPrice() {\n        const cachedGasPrice = await this.cache.get(this.GAS_KEY(this.chainId));\n        if (cachedGasPrice) {\n            log.info({ cachedGasPrice }, `Got gas station price from local cache: ${cachedGasPrice.gasPriceWei}.`);\n            return cachedGasPrice;\n        }\n        log.info('Gas station price local cache miss.');\n        const gasPrice = await this.gasPriceProvider.getGasPrice();\n        await this.cache.set(this.GAS_KEY(this.chainId), gasPrice);\n        return gasPrice;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGluZy1nYXMtcHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcHJvdmlkZXJzL2NhY2hpbmctZ2FzLXByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFJbEM7Ozs7O0dBS0c7QUFDSCxNQUFNLE9BQU8seUJBQXlCO0lBR3BDOzs7OztPQUtHO0lBQ0gsWUFDWSxPQUFnQixFQUNsQixnQkFBbUMsRUFDbkMsS0FBdUI7UUFGckIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNsQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW1CO1FBQ25DLFVBQUssR0FBTCxLQUFLLENBQWtCO1FBWHpCLFlBQU8sR0FBRyxDQUFDLE9BQWdCLEVBQUUsRUFBRSxDQUFDLFlBQVksT0FBTyxFQUFFLENBQUM7SUFZM0QsQ0FBQztJQUVHLEtBQUssQ0FBQyxXQUFXO1FBQ3RCLE1BQU0sY0FBYyxHQUFHLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUV4RSxJQUFJLGNBQWMsRUFBRTtZQUNsQixHQUFHLENBQUMsSUFBSSxDQUNOLEVBQUUsY0FBYyxFQUFFLEVBQ2xCLDJDQUEyQyxjQUFjLENBQUMsV0FBVyxHQUFHLENBQ3pFLENBQUM7WUFFRixPQUFPLGNBQWMsQ0FBQztTQUN2QjtRQUVELEdBQUcsQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUNoRCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRCxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7Q0FDRiJ9"]},"metadata":{},"sourceType":"module"}