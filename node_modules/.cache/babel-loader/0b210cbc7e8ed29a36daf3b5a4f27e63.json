{"ast":null,"code":"import _regeneratorRuntime from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { log } from '../util/log';\n/**\n * Provider for getting gas price, with functionality for caching the results.\n *\n * @export\n * @class CachingV3SubgraphProvider\n */\n\nexport var CachingGasStationProvider = /*#__PURE__*/function () {\n  /**\n   * Creates an instance of CachingGasStationProvider.\n   * @param chainId The chain id to use.\n   * @param gasPriceProvider The provider to use to get the gas price when not in the cache.\n   * @param cache Cache instance to hold cached pools.\n   */\n  function CachingGasStationProvider(chainId, gasPriceProvider, cache) {\n    _classCallCheck(this, CachingGasStationProvider);\n\n    this.chainId = chainId;\n    this.gasPriceProvider = gasPriceProvider;\n    this.cache = cache;\n\n    this.GAS_KEY = function (chainId) {\n      return \"gasPrice-\".concat(chainId);\n    };\n  }\n\n  _createClass(CachingGasStationProvider, [{\n    key: \"getGasPrice\",\n    value: function () {\n      var _getGasPrice = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var cachedGasPrice, gasPrice;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.cache.get(this.GAS_KEY(this.chainId));\n\n              case 2:\n                cachedGasPrice = _context.sent;\n\n                if (!cachedGasPrice) {\n                  _context.next = 6;\n                  break;\n                }\n\n                log.info({\n                  cachedGasPrice: cachedGasPrice\n                }, \"Got gas station price from local cache: \".concat(cachedGasPrice.gasPriceWei, \".\"));\n                return _context.abrupt(\"return\", cachedGasPrice);\n\n              case 6:\n                log.info('Gas station price local cache miss.');\n                _context.next = 9;\n                return this.gasPriceProvider.getGasPrice();\n\n              case 9:\n                gasPrice = _context.sent;\n                _context.next = 12;\n                return this.cache.set(this.GAS_KEY(this.chainId), gasPrice);\n\n              case 12:\n                return _context.abrupt(\"return\", gasPrice);\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getGasPrice() {\n        return _getGasPrice.apply(this, arguments);\n      }\n\n      return getGasPrice;\n    }()\n  }]);\n\n  return CachingGasStationProvider;\n}();","map":{"version":3,"sources":["../../../../src/providers/caching-gas-provider.ts"],"names":[],"mappings":";;;;AACA,SAAS,GAAT,QAAoB,aAApB;AAIA;;;;;AAKG;;AACH,WAAa,yBAAb;AAGE;;;;;AAKG;AACH,qCACY,OADZ,EAEU,gBAFV,EAGU,KAHV,EAGiC;AAAA;;AAFrB,SAAA,OAAA,GAAA,OAAA;AACF,SAAA,gBAAA,GAAA,gBAAA;AACA,SAAA,KAAA,GAAA,KAAA;;AAXF,SAAA,OAAA,GAAU,UAAC,OAAD;AAAA,gCAAkC,OAAlC;AAAA,KAAV;AAYJ;;AAbN;AAAA;AAAA;AAAA,kFAeS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACwB,KAAK,KAAL,CAAW,GAAX,CAAe,KAAK,OAAL,CAAa,KAAK,OAAlB,CAAf,CADxB;;AAAA;AACC,gBAAA,cADD;;AAAA,qBAGD,cAHC;AAAA;AAAA;AAAA;;AAIH,gBAAA,GAAG,CAAC,IAAJ,CACE;AAAE,kBAAA,cAAc,EAAd;AAAF,iBADF,oDAE6C,cAAc,CAAC,WAF5D;AAJG,iDASI,cATJ;;AAAA;AAYL,gBAAA,GAAG,CAAC,IAAJ,CAAS,qCAAT;AAZK;AAAA,uBAakB,KAAK,gBAAL,CAAsB,WAAtB,EAblB;;AAAA;AAaC,gBAAA,QAbD;AAAA;AAAA,uBAcC,KAAK,KAAL,CAAW,GAAX,CAAe,KAAK,OAAL,CAAa,KAAK,OAAlB,CAAf,EAA2C,QAA3C,CAdD;;AAAA;AAAA,iDAgBE,QAhBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAfT;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA","sourceRoot":"","sourcesContent":["import { log } from '../util/log';\n/**\n * Provider for getting gas price, with functionality for caching the results.\n *\n * @export\n * @class CachingV3SubgraphProvider\n */\nexport class CachingGasStationProvider {\n    /**\n     * Creates an instance of CachingGasStationProvider.\n     * @param chainId The chain id to use.\n     * @param gasPriceProvider The provider to use to get the gas price when not in the cache.\n     * @param cache Cache instance to hold cached pools.\n     */\n    constructor(chainId, gasPriceProvider, cache) {\n        this.chainId = chainId;\n        this.gasPriceProvider = gasPriceProvider;\n        this.cache = cache;\n        this.GAS_KEY = (chainId) => `gasPrice-${chainId}`;\n    }\n    async getGasPrice() {\n        const cachedGasPrice = await this.cache.get(this.GAS_KEY(this.chainId));\n        if (cachedGasPrice) {\n            log.info({ cachedGasPrice }, `Got gas station price from local cache: ${cachedGasPrice.gasPriceWei}.`);\n            return cachedGasPrice;\n        }\n        log.info('Gas station price local cache miss.');\n        const gasPrice = await this.gasPriceProvider.getGasPrice();\n        await this.cache.set(this.GAS_KEY(this.chainId), gasPrice);\n        return gasPrice;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGluZy1nYXMtcHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcHJvdmlkZXJzL2NhY2hpbmctZ2FzLXByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFJbEM7Ozs7O0dBS0c7QUFDSCxNQUFNLE9BQU8seUJBQXlCO0lBR3BDOzs7OztPQUtHO0lBQ0gsWUFDWSxPQUFnQixFQUNsQixnQkFBbUMsRUFDbkMsS0FBdUI7UUFGckIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNsQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW1CO1FBQ25DLFVBQUssR0FBTCxLQUFLLENBQWtCO1FBWHpCLFlBQU8sR0FBRyxDQUFDLE9BQWdCLEVBQUUsRUFBRSxDQUFDLFlBQVksT0FBTyxFQUFFLENBQUM7SUFZM0QsQ0FBQztJQUVHLEtBQUssQ0FBQyxXQUFXO1FBQ3RCLE1BQU0sY0FBYyxHQUFHLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUV4RSxJQUFJLGNBQWMsRUFBRTtZQUNsQixHQUFHLENBQUMsSUFBSSxDQUNOLEVBQUUsY0FBYyxFQUFFLEVBQ2xCLDJDQUEyQyxjQUFjLENBQUMsV0FBVyxHQUFHLENBQ3pFLENBQUM7WUFFRixPQUFPLGNBQWMsQ0FBQztTQUN2QjtRQUVELEdBQUcsQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUNoRCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzRCxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7Q0FDRiJ9"]},"metadata":{},"sourceType":"module"}