{"ast":null,"code":"import _styled from \"styled-components\";\n\nvar _jsxFileName = \"/Users/safahi/Downloads/interface-4.30.1/src/pages/CreateProposal/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { Trans } from \"@lingui/react\";\nimport { defaultAbiCoder } from '@ethersproject/abi';\nimport { getAddress, isAddress } from '@ethersproject/address';\nimport { ButtonError } from 'components/Button';\nimport { BlueCard } from 'components/Card';\nimport { AutoColumn } from 'components/Column';\nimport { useActiveWeb3React } from 'hooks/web3';\nimport JSBI from 'jsbi';\nimport { Wrapper } from 'pages/Pool/styleds';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { ProposalState, useCreateProposalCallback, useLatestProposalId, useProposalData, useProposalThreshold, useUserVotes } from 'state/governance/hooks';\nimport { tryParseAmount } from 'state/swap/hooks';\nimport { ExternalLink, ThemedText } from 'theme';\nimport { CreateProposalTabs } from '../../components/NavigationTabs';\nimport { UNI } from '../../constants/tokens';\nimport AppBody from '../AppBody';\nimport { ProposalActionDetail } from './ProposalActionDetail';\nimport { ProposalAction, ProposalActionSelector, ProposalActionSelectorModal } from './ProposalActionSelector';\nimport { ProposalEditor } from './ProposalEditor';\nimport { ProposalSubmissionModal } from './ProposalSubmissionModal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst CreateProposalButton = ({\n  proposalThreshold,\n  hasActiveOrPendingProposal,\n  hasEnoughVote,\n  isFormInvalid,\n  handleCreateProposal\n}) => {\n  const formattedProposalThreshold = proposalThreshold ? JSBI.divide(proposalThreshold.quotient, JSBI.exponentiate(JSBI.BigInt(10), JSBI.BigInt(proposalThreshold.currency.decimals))).toLocaleString() : undefined;\n  return /*#__PURE__*/_jsxDEV(ButtonError, {\n    style: {\n      marginTop: '18px'\n    },\n    error: hasActiveOrPendingProposal || !hasEnoughVote,\n    disabled: isFormInvalid || hasActiveOrPendingProposal || !hasEnoughVote,\n    onClick: handleCreateProposal,\n    children: hasActiveOrPendingProposal ? /*#__PURE__*/_jsxDEV(Trans, {\n      id: \"You already have an active or pending proposal\"\n    }, void 0, false, void 0, this) : !hasEnoughVote ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: formattedProposalThreshold ? /*#__PURE__*/_jsxDEV(Trans, {\n        id: \"You must have {formattedProposalThreshold} votes to submit a proposal\",\n        values: {\n          formattedProposalThreshold: formattedProposalThreshold\n        }\n      }, void 0, false, void 0, this) : /*#__PURE__*/_jsxDEV(Trans, {\n        id: \"You don't have enough votes to submit a proposal\"\n      }, void 0, false, void 0, this)\n    }, void 0, false) : /*#__PURE__*/_jsxDEV(Trans, {\n      id: \"Create Proposal\"\n    }, void 0, false, void 0, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }, this);\n};\n\n_c = CreateProposalButton;\n\nconst CreateProposalWrapper = _styled(Wrapper).withConfig({\n  displayName: \"CreateProposal__CreateProposalWrapper\",\n  componentId: \"sc-38qcfg-0\"\n})([\"display:flex;flex-flow:column wrap;\"]);\n\nconst AutonomousProposalCTA = _styled.div.withConfig({\n  displayName: \"CreateProposal__AutonomousProposalCTA\",\n  componentId: \"sc-38qcfg-1\"\n})([\"text-align:center;margin-top:10px;\"]);\n\nexport default function CreateProposal() {\n  _s();\n\n  var _useLatestProposalId;\n\n  const {\n    account,\n    chainId\n  } = useActiveWeb3React();\n  const latestProposalId = (_useLatestProposalId = useLatestProposalId(account !== null && account !== void 0 ? account : undefined)) !== null && _useLatestProposalId !== void 0 ? _useLatestProposalId : '0'; // the first argument below should be the index of the latest governor\n\n  const latestProposalData = useProposalData(\n  /* governorIndex */\n  2, latestProposalId);\n  const {\n    votes: availableVotes\n  } = useUserVotes();\n  const proposalThreshold = useProposalThreshold();\n  const [modalOpen, setModalOpen] = useState(false);\n  const [hash, setHash] = useState();\n  const [attempting, setAttempting] = useState(false);\n  const [proposalAction, setProposalAction] = useState(ProposalAction.TRANSFER_TOKEN);\n  const [toAddressValue, setToAddressValue] = useState('');\n  const [currencyValue, setCurrencyValue] = useState(UNI[chainId !== null && chainId !== void 0 ? chainId : 1]);\n  const [amountValue, setAmountValue] = useState('');\n  const [titleValue, setTitleValue] = useState('');\n  const [bodyValue, setBodyValue] = useState('');\n  const handleActionSelectorClick = useCallback(() => {\n    setModalOpen(true);\n  }, [setModalOpen]);\n  const handleActionChange = useCallback(proposalAction => {\n    setProposalAction(proposalAction);\n  }, [setProposalAction]);\n  const handleDismissActionSelector = useCallback(() => {\n    setModalOpen(false);\n  }, [setModalOpen]);\n  const handleDismissSubmissionModal = useCallback(() => {\n    setHash(undefined);\n    setAttempting(false);\n  }, [setHash, setAttempting]);\n  const handleToAddressInput = useCallback(toAddress => {\n    setToAddressValue(toAddress);\n  }, [setToAddressValue]);\n  const handleCurrencySelect = useCallback(currency => {\n    setCurrencyValue(currency);\n  }, [setCurrencyValue]);\n  const handleAmountInput = useCallback(amount => {\n    setAmountValue(amount);\n  }, [setAmountValue]);\n  const handleTitleInput = useCallback(title => {\n    setTitleValue(title);\n  }, [setTitleValue]);\n  const handleBodyInput = useCallback(body => {\n    setBodyValue(body);\n  }, [setBodyValue]);\n  const isFormInvalid = useMemo(() => Boolean(!proposalAction || !isAddress(toAddressValue) || !(currencyValue === null || currencyValue === void 0 ? void 0 : currencyValue.isToken) || amountValue === '' || titleValue === '' || bodyValue === ''), [proposalAction, toAddressValue, currencyValue, amountValue, titleValue, bodyValue]);\n  const hasEnoughVote = Boolean(availableVotes && proposalThreshold && JSBI.greaterThanOrEqual(availableVotes.quotient, proposalThreshold.quotient));\n  const createProposalCallback = useCreateProposalCallback();\n\n  const handleCreateProposal = async () => {\n    var _createProposalCallba;\n\n    setAttempting(true);\n    const createProposalData = {};\n    if (!createProposalCallback || !proposalAction || !currencyValue.isToken) return;\n    const tokenAmount = tryParseAmount(amountValue, currencyValue);\n    if (!tokenAmount) return;\n    createProposalData.targets = [currencyValue.address];\n    createProposalData.values = ['0'];\n    createProposalData.description = `# ${titleValue}\n\n${bodyValue}\n`;\n    let types;\n    let values;\n\n    switch (proposalAction) {\n      case ProposalAction.TRANSFER_TOKEN:\n        {\n          types = [['address', 'uint256']];\n          values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]];\n          createProposalData.signatures = [`transfer(${types[0].join(',')})`];\n          break;\n        }\n\n      case ProposalAction.APPROVE_TOKEN:\n        {\n          types = [['address', 'uint256']];\n          values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]];\n          createProposalData.signatures = [`approve(${types[0].join(',')})`];\n          break;\n        }\n    }\n\n    createProposalData.calldatas = [];\n\n    for (let i = 0; i < createProposalData.signatures.length; i++) {\n      createProposalData.calldatas[i] = defaultAbiCoder.encode(types[i], values[i]);\n    }\n\n    const hash = await ((_createProposalCallba = createProposalCallback(createProposalData !== null && createProposalData !== void 0 ? createProposalData : undefined)) === null || _createProposalCallba === void 0 ? void 0 : _createProposalCallba.catch(() => {\n      setAttempting(false);\n    }));\n    if (hash) setHash(hash);\n  };\n\n  return /*#__PURE__*/_jsxDEV(AppBody, {\n    maxWidth: '800px',\n    children: [/*#__PURE__*/_jsxDEV(CreateProposalTabs, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CreateProposalWrapper, {\n      children: [/*#__PURE__*/_jsxDEV(BlueCard, {\n        children: /*#__PURE__*/_jsxDEV(AutoColumn, {\n          gap: \"10px\",\n          children: /*#__PURE__*/_jsxDEV(ThemedText.Link, {\n            fontWeight: 400,\n            color: 'primaryText1',\n            children: /*#__PURE__*/_jsxDEV(Trans, {\n              id: \"<0>Tip:</0> Select an action and describe your proposal for the community. The proposal cannot be modified after submission, so please verify all information before submitting. The voting period will begin immediately and last for 7 days. To propose a custom action, <1>read the docs</1>.\",\n              components: {\n                0: /*#__PURE__*/_jsxDEV(\"strong\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 17\n                }, this),\n                1: /*#__PURE__*/_jsxDEV(ExternalLink, {\n                  href: \"https://uniswap.org/docs/v2/governance/governance-reference/#propose\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 17\n                }, this)\n              }\n            }, void 0, false, void 0, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ProposalActionSelector, {\n        onClick: handleActionSelectorClick,\n        proposalAction: proposalAction\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ProposalActionDetail, {\n        proposalAction: proposalAction,\n        currency: currencyValue,\n        amount: amountValue,\n        toAddress: toAddressValue,\n        onCurrencySelect: handleCurrencySelect,\n        onAmountInput: handleAmountInput,\n        onToAddressInput: handleToAddressInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ProposalEditor, {\n        title: titleValue,\n        body: bodyValue,\n        onTitleInput: handleTitleInput,\n        onBodyInput: handleBodyInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CreateProposalButton, {\n        proposalThreshold: proposalThreshold,\n        hasActiveOrPendingProposal: (latestProposalData === null || latestProposalData === void 0 ? void 0 : latestProposalData.status) === ProposalState.ACTIVE || (latestProposalData === null || latestProposalData === void 0 ? void 0 : latestProposalData.status) === ProposalState.PENDING,\n        hasEnoughVote: hasEnoughVote,\n        isFormInvalid: isFormInvalid,\n        handleCreateProposal: handleCreateProposal\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this), !hasEnoughVote ? /*#__PURE__*/_jsxDEV(AutonomousProposalCTA, {\n        children: [\"Don\\u2019t have 2.5M votes? Anyone can create an autonomous proposal using\", ' ', /*#__PURE__*/_jsxDEV(ExternalLink, {\n          href: \"https://fish.vote\",\n          children: \"fish.vote\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 11\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProposalActionSelectorModal, {\n      isOpen: modalOpen,\n      onDismiss: handleDismissActionSelector,\n      onProposalActionSelect: proposalAction => handleActionChange(proposalAction)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProposalSubmissionModal, {\n      isOpen: attempting,\n      hash: hash,\n      onDismiss: handleDismissSubmissionModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 228,\n    columnNumber: 5\n  }, this);\n}\n\n_s(CreateProposal, \"8urNaFbONbdmWkfMswUFcC4mQdc=\", false, function () {\n  return [useActiveWeb3React, useLatestProposalId, useProposalData, useUserVotes, useProposalThreshold, useCreateProposalCallback];\n});\n\n_c2 = CreateProposal;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CreateProposalButton\");\n$RefreshReg$(_c2, \"CreateProposal\");","map":{"version":3,"sources":["/Users/safahi/Downloads/interface-4.30.1/src/pages/CreateProposal/index.tsx"],"names":["defaultAbiCoder","getAddress","isAddress","ButtonError","BlueCard","AutoColumn","useActiveWeb3React","JSBI","Wrapper","React","useCallback","useMemo","useState","ProposalState","useCreateProposalCallback","useLatestProposalId","useProposalData","useProposalThreshold","useUserVotes","tryParseAmount","ExternalLink","ThemedText","CreateProposalTabs","UNI","AppBody","ProposalActionDetail","ProposalAction","ProposalActionSelector","ProposalActionSelectorModal","ProposalEditor","ProposalSubmissionModal","CreateProposalButton","proposalThreshold","hasActiveOrPendingProposal","hasEnoughVote","isFormInvalid","handleCreateProposal","formattedProposalThreshold","divide","quotient","exponentiate","BigInt","currency","decimals","toLocaleString","undefined","marginTop","CreateProposalWrapper","styled","AutonomousProposalCTA","div","CreateProposal","account","chainId","latestProposalId","latestProposalData","votes","availableVotes","modalOpen","setModalOpen","hash","setHash","attempting","setAttempting","proposalAction","setProposalAction","TRANSFER_TOKEN","toAddressValue","setToAddressValue","currencyValue","setCurrencyValue","amountValue","setAmountValue","titleValue","setTitleValue","bodyValue","setBodyValue","handleActionSelectorClick","handleActionChange","handleDismissActionSelector","handleDismissSubmissionModal","handleToAddressInput","toAddress","handleCurrencySelect","handleAmountInput","amount","handleTitleInput","title","handleBodyInput","body","Boolean","isToken","greaterThanOrEqual","createProposalCallback","createProposalData","tokenAmount","targets","address","values","description","types","toString","signatures","join","APPROVE_TOKEN","calldatas","i","length","encode","catch","maxWidth","status","ACTIVE","PENDING"],"mappings":";;;;;;AAAA,SAASA,eAAT,QAAgC,oBAAhC;AACA,SAASC,UAAT,EAAqBC,SAArB,QAAsC,wBAAtC;AAGA,SAASC,WAAT,QAA4B,mBAA5B;AACA,SAASC,QAAT,QAAyB,iBAAzB;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,SAASC,kBAAT,QAAmC,YAAnC;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,SAASC,OAAT,QAAwB,oBAAxB;AACA,OAAOC,KAAP,IAAgBC,WAAhB,EAA6BC,OAA7B,EAAsCC,QAAtC,QAAsD,OAAtD;AACA,SAEEC,aAFF,EAGEC,yBAHF,EAIEC,mBAJF,EAKEC,eALF,EAMEC,oBANF,EAOEC,YAPF,QAQO,wBARP;AASA,SAASC,cAAT,QAA+B,kBAA/B;AAEA,SAASC,YAAT,EAAuBC,UAAvB,QAAyC,OAAzC;AAEA,SAASC,kBAAT,QAAmC,iCAAnC;AACA,SAASC,GAAT,QAAoB,wBAApB;AACA,OAAOC,OAAP,MAAoB,YAApB;AACA,SAASC,oBAAT,QAAqC,wBAArC;AACA,SAASC,cAAT,EAAyBC,sBAAzB,EAAiDC,2BAAjD,QAAoF,0BAApF;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,uBAAT,QAAwC,2BAAxC;;;;AAEA,MAAMC,oBAAoB,GAAG,CAAC;AAC5BC,EAAAA,iBAD4B;AAE5BC,EAAAA,0BAF4B;AAG5BC,EAAAA,aAH4B;AAI5BC,EAAAA,aAJ4B;AAK5BC,EAAAA;AAL4B,CAAD,KAYvB;AACJ,QAAMC,0BAA0B,GAAGL,iBAAiB,GAChDzB,IAAI,CAAC+B,MAAL,CACEN,iBAAiB,CAACO,QADpB,EAEEhC,IAAI,CAACiC,YAAL,CAAkBjC,IAAI,CAACkC,MAAL,CAAY,EAAZ,CAAlB,EAAmClC,IAAI,CAACkC,MAAL,CAAYT,iBAAiB,CAACU,QAAlB,CAA2BC,QAAvC,CAAnC,CAFF,EAGEC,cAHF,EADgD,GAKhDC,SALJ;AAOA,sBACE,QAAC,WAAD;AACE,IAAA,KAAK,EAAE;AAAEC,MAAAA,SAAS,EAAE;AAAb,KADT;AAEE,IAAA,KAAK,EAAEb,0BAA0B,IAAI,CAACC,aAFxC;AAGE,IAAA,QAAQ,EAAEC,aAAa,IAAIF,0BAAjB,IAA+C,CAACC,aAH5D;AAIE,IAAA,OAAO,EAAEE,oBAJX;AAAA,cAMGH,0BAA0B,gBACzB;AAAA;AAAA,mCADyB,GAEvB,CAACC,aAAD,gBACF;AAAA,gBACGG,0BAA0B,gBACzB;AAAA;AAAA;AAAA,sCAAsBA;AAAtB;AAAA,qCADyB,gBAGzB;AAAA;AAAA;AAJJ,qBADE,gBASF;AAAA;AAAA;AAjBJ;AAAA;AAAA;AAAA;AAAA,UADF;AAsBD,CA1CD;;KAAMN,oB;;AA4CN,MAAMgB,qBAAqB,GAAGC,OAAM,CAACxC,OAAD,CAAT;AAAA;AAAA;AAAA,2CAA3B;;AAKA,MAAMyC,qBAAqB,GAAGD,OAAM,CAACE,GAAV;AAAA;AAAA;AAAA,0CAA3B;;AAKA,eAAe,SAASC,cAAT,GAA0B;AAAA;;AAAA;;AACvC,QAAM;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAuB/C,kBAAkB,EAA/C;AAEA,QAAMgD,gBAAgB,2BAAGvC,mBAAmB,CAACqC,OAAD,aAACA,OAAD,cAACA,OAAD,GAAYP,SAAZ,CAAtB,uEAAgD,GAAtE,CAHuC,CAIvC;;AACA,QAAMU,kBAAkB,GAAGvC,eAAe;AAAC;AAAoB,GAArB,EAAwBsC,gBAAxB,CAA1C;AACA,QAAM;AAAEE,IAAAA,KAAK,EAAEC;AAAT,MAA4BvC,YAAY,EAA9C;AACA,QAAMc,iBAAoD,GAAGf,oBAAoB,EAAjF;AAEA,QAAM,CAACyC,SAAD,EAAYC,YAAZ,IAA4B/C,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAACgD,IAAD,EAAOC,OAAP,IAAkBjD,QAAQ,EAAhC;AACA,QAAM,CAACkD,UAAD,EAAaC,aAAb,IAA8BnD,QAAQ,CAAC,KAAD,CAA5C;AACA,QAAM,CAACoD,cAAD,EAAiBC,iBAAjB,IAAsCrD,QAAQ,CAACc,cAAc,CAACwC,cAAhB,CAApD;AACA,QAAM,CAACC,cAAD,EAAiBC,iBAAjB,IAAsCxD,QAAQ,CAAC,EAAD,CAApD;AACA,QAAM,CAACyD,aAAD,EAAgBC,gBAAhB,IAAoC1D,QAAQ,CAAWW,GAAG,CAAC8B,OAAD,aAACA,OAAD,cAACA,OAAD,GAAY,CAAZ,CAAd,CAAlD;AACA,QAAM,CAACkB,WAAD,EAAcC,cAAd,IAAgC5D,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAAC6D,UAAD,EAAaC,aAAb,IAA8B9D,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAAC+D,SAAD,EAAYC,YAAZ,IAA4BhE,QAAQ,CAAC,EAAD,CAA1C;AAEA,QAAMiE,yBAAyB,GAAGnE,WAAW,CAAC,MAAM;AAClDiD,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACD,GAF4C,EAE1C,CAACA,YAAD,CAF0C,CAA7C;AAIA,QAAMmB,kBAAkB,GAAGpE,WAAW,CACnCsD,cAAD,IAAoC;AAClCC,IAAAA,iBAAiB,CAACD,cAAD,CAAjB;AACD,GAHmC,EAIpC,CAACC,iBAAD,CAJoC,CAAtC;AAOA,QAAMc,2BAA2B,GAAGrE,WAAW,CAAC,MAAM;AACpDiD,IAAAA,YAAY,CAAC,KAAD,CAAZ;AACD,GAF8C,EAE5C,CAACA,YAAD,CAF4C,CAA/C;AAIA,QAAMqB,4BAA4B,GAAGtE,WAAW,CAAC,MAAM;AACrDmD,IAAAA,OAAO,CAAChB,SAAD,CAAP;AACAkB,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GAH+C,EAG7C,CAACF,OAAD,EAAUE,aAAV,CAH6C,CAAhD;AAKA,QAAMkB,oBAAoB,GAAGvE,WAAW,CACrCwE,SAAD,IAAuB;AACrBd,IAAAA,iBAAiB,CAACc,SAAD,CAAjB;AACD,GAHqC,EAItC,CAACd,iBAAD,CAJsC,CAAxC;AAOA,QAAMe,oBAAoB,GAAGzE,WAAW,CACrCgC,QAAD,IAAwB;AACtB4B,IAAAA,gBAAgB,CAAC5B,QAAD,CAAhB;AACD,GAHqC,EAItC,CAAC4B,gBAAD,CAJsC,CAAxC;AAOA,QAAMc,iBAAiB,GAAG1E,WAAW,CAClC2E,MAAD,IAAoB;AAClBb,IAAAA,cAAc,CAACa,MAAD,CAAd;AACD,GAHkC,EAInC,CAACb,cAAD,CAJmC,CAArC;AAOA,QAAMc,gBAAgB,GAAG5E,WAAW,CACjC6E,KAAD,IAAmB;AACjBb,IAAAA,aAAa,CAACa,KAAD,CAAb;AACD,GAHiC,EAIlC,CAACb,aAAD,CAJkC,CAApC;AAOA,QAAMc,eAAe,GAAG9E,WAAW,CAChC+E,IAAD,IAAkB;AAChBb,IAAAA,YAAY,CAACa,IAAD,CAAZ;AACD,GAHgC,EAIjC,CAACb,YAAD,CAJiC,CAAnC;AAOA,QAAMzC,aAAa,GAAGxB,OAAO,CAC3B,MACE+E,OAAO,CACL,CAAC1B,cAAD,IACE,CAAC9D,SAAS,CAACiE,cAAD,CADZ,IAEE,EAACE,aAAD,aAACA,aAAD,uBAACA,aAAa,CAAEsB,OAAhB,CAFF,IAGEpB,WAAW,KAAK,EAHlB,IAIEE,UAAU,KAAK,EAJjB,IAKEE,SAAS,KAAK,EANX,CAFkB,EAU3B,CAACX,cAAD,EAAiBG,cAAjB,EAAiCE,aAAjC,EAAgDE,WAAhD,EAA6DE,UAA7D,EAAyEE,SAAzE,CAV2B,CAA7B;AAaA,QAAMzC,aAAa,GAAGwD,OAAO,CAC3BjC,cAAc,IAAIzB,iBAAlB,IAAuCzB,IAAI,CAACqF,kBAAL,CAAwBnC,cAAc,CAAClB,QAAvC,EAAiDP,iBAAiB,CAACO,QAAnE,CADZ,CAA7B;AAIA,QAAMsD,sBAAsB,GAAG/E,yBAAyB,EAAxD;;AAEA,QAAMsB,oBAAoB,GAAG,YAAY;AAAA;;AACvC2B,IAAAA,aAAa,CAAC,IAAD,CAAb;AAEA,UAAM+B,kBAAsC,GAAG,EAA/C;AAEA,QAAI,CAACD,sBAAD,IAA2B,CAAC7B,cAA5B,IAA8C,CAACK,aAAa,CAACsB,OAAjE,EAA0E;AAE1E,UAAMI,WAAW,GAAG5E,cAAc,CAACoD,WAAD,EAAcF,aAAd,CAAlC;AACA,QAAI,CAAC0B,WAAL,EAAkB;AAElBD,IAAAA,kBAAkB,CAACE,OAAnB,GAA6B,CAAC3B,aAAa,CAAC4B,OAAf,CAA7B;AACAH,IAAAA,kBAAkB,CAACI,MAAnB,GAA4B,CAAC,GAAD,CAA5B;AACAJ,IAAAA,kBAAkB,CAACK,WAAnB,GAAkC,KAAI1B,UAAW;AACrD;AACA,EAAEE,SAAU;AACZ,CAHI;AAKA,QAAIyB,KAAJ;AACA,QAAIF,MAAJ;;AACA,YAAQlC,cAAR;AACE,WAAKtC,cAAc,CAACwC,cAApB;AAAoC;AAClCkC,UAAAA,KAAK,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,CAAD,CAAR;AACAF,UAAAA,MAAM,GAAG,CAAC,CAACjG,UAAU,CAACkE,cAAD,CAAX,EAA6B4B,WAAW,CAACxD,QAAZ,CAAqB8D,QAArB,EAA7B,CAAD,CAAT;AACAP,UAAAA,kBAAkB,CAACQ,UAAnB,GAAgC,CAAE,YAAWF,KAAK,CAAC,CAAD,CAAL,CAASG,IAAT,CAAc,GAAd,CAAmB,GAAhC,CAAhC;AACA;AACD;;AAED,WAAK7E,cAAc,CAAC8E,aAApB;AAAmC;AACjCJ,UAAAA,KAAK,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,CAAD,CAAR;AACAF,UAAAA,MAAM,GAAG,CAAC,CAACjG,UAAU,CAACkE,cAAD,CAAX,EAA6B4B,WAAW,CAACxD,QAAZ,CAAqB8D,QAArB,EAA7B,CAAD,CAAT;AACAP,UAAAA,kBAAkB,CAACQ,UAAnB,GAAgC,CAAE,WAAUF,KAAK,CAAC,CAAD,CAAL,CAASG,IAAT,CAAc,GAAd,CAAmB,GAA/B,CAAhC;AACA;AACD;AAbH;;AAgBAT,IAAAA,kBAAkB,CAACW,SAAnB,GAA+B,EAA/B;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,kBAAkB,CAACQ,UAAnB,CAA8BK,MAAlD,EAA0DD,CAAC,EAA3D,EAA+D;AAC7DZ,MAAAA,kBAAkB,CAACW,SAAnB,CAA6BC,CAA7B,IAAkC1G,eAAe,CAAC4G,MAAhB,CAAuBR,KAAK,CAACM,CAAD,CAA5B,EAAiCR,MAAM,CAACQ,CAAD,CAAvC,CAAlC;AACD;;AAED,UAAM9C,IAAI,GAAG,gCAAMiC,sBAAsB,CAACC,kBAAD,aAACA,kBAAD,cAACA,kBAAD,GAAuBjD,SAAvB,CAA5B,0DAAM,sBAAyDgE,KAAzD,CAA+D,MAAM;AACtF9C,MAAAA,aAAa,CAAC,KAAD,CAAb;AACD,KAFkB,CAAN,CAAb;AAIA,QAAIH,IAAJ,EAAUC,OAAO,CAACD,IAAD,CAAP;AACX,GA7CD;;AA+CA,sBACE,QAAC,OAAD;AAAekD,IAAAA,QAAQ,EAAE,OAAzB;AAAA,4BACE,QAAC,kBAAD;AAAA;AAAA;AAAA;AAAA,YADF,eAEE,QAAC,qBAAD;AAAA,8BACE,QAAC,QAAD;AAAA,+BACE,QAAC,UAAD;AAAY,UAAA,GAAG,EAAC,MAAhB;AAAA,iCACE,QAAC,UAAD,CAAY,IAAZ;AAAiB,YAAA,UAAU,EAAE,GAA7B;AAAkC,YAAA,KAAK,EAAE,cAAzC;AAAA,mCACE;AAAA;AAAA;AAAA,gCACE;AAAA;AAAA;AAAA;AAAA,wBADF;AAAA,gCAIE,QAAC,YAAD;AAAc,kBAAA,IAAI,EAAC;AAAnB;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF,eAiBE,QAAC,sBAAD;AAAwB,QAAA,OAAO,EAAEjC,yBAAjC;AAA4D,QAAA,cAAc,EAAEb;AAA5E;AAAA;AAAA;AAAA;AAAA,cAjBF,eAkBE,QAAC,oBAAD;AACE,QAAA,cAAc,EAAEA,cADlB;AAEE,QAAA,QAAQ,EAAEK,aAFZ;AAGE,QAAA,MAAM,EAAEE,WAHV;AAIE,QAAA,SAAS,EAAEJ,cAJb;AAKE,QAAA,gBAAgB,EAAEgB,oBALpB;AAME,QAAA,aAAa,EAAEC,iBANjB;AAOE,QAAA,gBAAgB,EAAEH;AAPpB;AAAA;AAAA;AAAA;AAAA,cAlBF,eA2BE,QAAC,cAAD;AACE,QAAA,KAAK,EAAER,UADT;AAEE,QAAA,IAAI,EAAEE,SAFR;AAGE,QAAA,YAAY,EAAEW,gBAHhB;AAIE,QAAA,WAAW,EAAEE;AAJf;AAAA;AAAA;AAAA;AAAA,cA3BF,eAiCE,QAAC,oBAAD;AACE,QAAA,iBAAiB,EAAExD,iBADrB;AAEE,QAAA,0BAA0B,EACxB,CAAAuB,kBAAkB,SAAlB,IAAAA,kBAAkB,WAAlB,YAAAA,kBAAkB,CAAEwD,MAApB,MAA+BlG,aAAa,CAACmG,MAA7C,IAAuD,CAAAzD,kBAAkB,SAAlB,IAAAA,kBAAkB,WAAlB,YAAAA,kBAAkB,CAAEwD,MAApB,MAA+BlG,aAAa,CAACoG,OAHxG;AAKE,QAAA,aAAa,EAAE/E,aALjB;AAME,QAAA,aAAa,EAAEC,aANjB;AAOE,QAAA,oBAAoB,EAAEC;AAPxB;AAAA;AAAA;AAAA;AAAA,cAjCF,EA0CG,CAACF,aAAD,gBACC,QAAC,qBAAD;AAAA,iGACwE,GADxE,eAEE,QAAC,YAAD;AAAc,UAAA,IAAI,EAAC,mBAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,cADD,GAKG,IA/CN;AAAA;AAAA;AAAA;AAAA;AAAA,YAFF,eAmDE,QAAC,2BAAD;AACE,MAAA,MAAM,EAAEwB,SADV;AAEE,MAAA,SAAS,EAAEqB,2BAFb;AAGE,MAAA,sBAAsB,EAAGf,cAAD,IAAoCc,kBAAkB,CAACd,cAAD;AAHhF;AAAA;AAAA;AAAA;AAAA,YAnDF,eAwDE,QAAC,uBAAD;AAAyB,MAAA,MAAM,EAAEF,UAAjC;AAA6C,MAAA,IAAI,EAAEF,IAAnD;AAAyD,MAAA,SAAS,EAAEoB;AAApE;AAAA;AAAA;AAAA;AAAA,YAxDF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AA4DD;;GAxMuB7B,c;UACO7C,kB,EAEJS,mB,EAEEC,e,EACOE,Y,EAC2BD,oB,EAoF9BH,yB;;;MA3FTqC,c","sourcesContent":["import { defaultAbiCoder } from '@ethersproject/abi'\nimport { getAddress, isAddress } from '@ethersproject/address'\nimport { Trans } from '@lingui/macro'\nimport { Currency, CurrencyAmount, Token } from '@uniswap/sdk-core'\nimport { ButtonError } from 'components/Button'\nimport { BlueCard } from 'components/Card'\nimport { AutoColumn } from 'components/Column'\nimport { useActiveWeb3React } from 'hooks/web3'\nimport JSBI from 'jsbi'\nimport { Wrapper } from 'pages/Pool/styleds'\nimport React, { useCallback, useMemo, useState } from 'react'\nimport {\n  CreateProposalData,\n  ProposalState,\n  useCreateProposalCallback,\n  useLatestProposalId,\n  useProposalData,\n  useProposalThreshold,\n  useUserVotes,\n} from 'state/governance/hooks'\nimport { tryParseAmount } from 'state/swap/hooks'\nimport styled from 'styled-components/macro'\nimport { ExternalLink, ThemedText } from 'theme'\n\nimport { CreateProposalTabs } from '../../components/NavigationTabs'\nimport { UNI } from '../../constants/tokens'\nimport AppBody from '../AppBody'\nimport { ProposalActionDetail } from './ProposalActionDetail'\nimport { ProposalAction, ProposalActionSelector, ProposalActionSelectorModal } from './ProposalActionSelector'\nimport { ProposalEditor } from './ProposalEditor'\nimport { ProposalSubmissionModal } from './ProposalSubmissionModal'\n\nconst CreateProposalButton = ({\n  proposalThreshold,\n  hasActiveOrPendingProposal,\n  hasEnoughVote,\n  isFormInvalid,\n  handleCreateProposal,\n}: {\n  proposalThreshold?: CurrencyAmount<Token>\n  hasActiveOrPendingProposal: boolean\n  hasEnoughVote: boolean\n  isFormInvalid: boolean\n  handleCreateProposal: () => void\n}) => {\n  const formattedProposalThreshold = proposalThreshold\n    ? JSBI.divide(\n        proposalThreshold.quotient,\n        JSBI.exponentiate(JSBI.BigInt(10), JSBI.BigInt(proposalThreshold.currency.decimals))\n      ).toLocaleString()\n    : undefined\n\n  return (\n    <ButtonError\n      style={{ marginTop: '18px' }}\n      error={hasActiveOrPendingProposal || !hasEnoughVote}\n      disabled={isFormInvalid || hasActiveOrPendingProposal || !hasEnoughVote}\n      onClick={handleCreateProposal}\n    >\n      {hasActiveOrPendingProposal ? (\n        <Trans>You already have an active or pending proposal</Trans>\n      ) : !hasEnoughVote ? (\n        <>\n          {formattedProposalThreshold ? (\n            <Trans>You must have {formattedProposalThreshold} votes to submit a proposal</Trans>\n          ) : (\n            <Trans>You don&apos;t have enough votes to submit a proposal</Trans>\n          )}\n        </>\n      ) : (\n        <Trans>Create Proposal</Trans>\n      )}\n    </ButtonError>\n  )\n}\n\nconst CreateProposalWrapper = styled(Wrapper)`\n  display: flex;\n  flex-flow: column wrap;\n`\n\nconst AutonomousProposalCTA = styled.div`\n  text-align: center;\n  margin-top: 10px;\n`\n\nexport default function CreateProposal() {\n  const { account, chainId } = useActiveWeb3React()\n\n  const latestProposalId = useLatestProposalId(account ?? undefined) ?? '0'\n  // the first argument below should be the index of the latest governor\n  const latestProposalData = useProposalData(/* governorIndex */ 2, latestProposalId)\n  const { votes: availableVotes } = useUserVotes()\n  const proposalThreshold: CurrencyAmount<Token> | undefined = useProposalThreshold()\n\n  const [modalOpen, setModalOpen] = useState(false)\n  const [hash, setHash] = useState<string | undefined>()\n  const [attempting, setAttempting] = useState(false)\n  const [proposalAction, setProposalAction] = useState(ProposalAction.TRANSFER_TOKEN)\n  const [toAddressValue, setToAddressValue] = useState('')\n  const [currencyValue, setCurrencyValue] = useState<Currency>(UNI[chainId ?? 1])\n  const [amountValue, setAmountValue] = useState('')\n  const [titleValue, setTitleValue] = useState('')\n  const [bodyValue, setBodyValue] = useState('')\n\n  const handleActionSelectorClick = useCallback(() => {\n    setModalOpen(true)\n  }, [setModalOpen])\n\n  const handleActionChange = useCallback(\n    (proposalAction: ProposalAction) => {\n      setProposalAction(proposalAction)\n    },\n    [setProposalAction]\n  )\n\n  const handleDismissActionSelector = useCallback(() => {\n    setModalOpen(false)\n  }, [setModalOpen])\n\n  const handleDismissSubmissionModal = useCallback(() => {\n    setHash(undefined)\n    setAttempting(false)\n  }, [setHash, setAttempting])\n\n  const handleToAddressInput = useCallback(\n    (toAddress: string) => {\n      setToAddressValue(toAddress)\n    },\n    [setToAddressValue]\n  )\n\n  const handleCurrencySelect = useCallback(\n    (currency: Currency) => {\n      setCurrencyValue(currency)\n    },\n    [setCurrencyValue]\n  )\n\n  const handleAmountInput = useCallback(\n    (amount: string) => {\n      setAmountValue(amount)\n    },\n    [setAmountValue]\n  )\n\n  const handleTitleInput = useCallback(\n    (title: string) => {\n      setTitleValue(title)\n    },\n    [setTitleValue]\n  )\n\n  const handleBodyInput = useCallback(\n    (body: string) => {\n      setBodyValue(body)\n    },\n    [setBodyValue]\n  )\n\n  const isFormInvalid = useMemo(\n    () =>\n      Boolean(\n        !proposalAction ||\n          !isAddress(toAddressValue) ||\n          !currencyValue?.isToken ||\n          amountValue === '' ||\n          titleValue === '' ||\n          bodyValue === ''\n      ),\n    [proposalAction, toAddressValue, currencyValue, amountValue, titleValue, bodyValue]\n  )\n\n  const hasEnoughVote = Boolean(\n    availableVotes && proposalThreshold && JSBI.greaterThanOrEqual(availableVotes.quotient, proposalThreshold.quotient)\n  )\n\n  const createProposalCallback = useCreateProposalCallback()\n\n  const handleCreateProposal = async () => {\n    setAttempting(true)\n\n    const createProposalData: CreateProposalData = {} as CreateProposalData\n\n    if (!createProposalCallback || !proposalAction || !currencyValue.isToken) return\n\n    const tokenAmount = tryParseAmount(amountValue, currencyValue)\n    if (!tokenAmount) return\n\n    createProposalData.targets = [currencyValue.address]\n    createProposalData.values = ['0']\n    createProposalData.description = `# ${titleValue}\n\n${bodyValue}\n`\n\n    let types: string[][]\n    let values: string[][]\n    switch (proposalAction) {\n      case ProposalAction.TRANSFER_TOKEN: {\n        types = [['address', 'uint256']]\n        values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]]\n        createProposalData.signatures = [`transfer(${types[0].join(',')})`]\n        break\n      }\n\n      case ProposalAction.APPROVE_TOKEN: {\n        types = [['address', 'uint256']]\n        values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]]\n        createProposalData.signatures = [`approve(${types[0].join(',')})`]\n        break\n      }\n    }\n\n    createProposalData.calldatas = []\n    for (let i = 0; i < createProposalData.signatures.length; i++) {\n      createProposalData.calldatas[i] = defaultAbiCoder.encode(types[i], values[i])\n    }\n\n    const hash = await createProposalCallback(createProposalData ?? undefined)?.catch(() => {\n      setAttempting(false)\n    })\n\n    if (hash) setHash(hash)\n  }\n\n  return (\n    <AppBody {...{ maxWidth: '800px' }}>\n      <CreateProposalTabs />\n      <CreateProposalWrapper>\n        <BlueCard>\n          <AutoColumn gap=\"10px\">\n            <ThemedText.Link fontWeight={400} color={'primaryText1'}>\n              <Trans>\n                <strong>Tip:</strong> Select an action and describe your proposal for the community. The proposal cannot\n                be modified after submission, so please verify all information before submitting. The voting period will\n                begin immediately and last for 7 days. To propose a custom action,{' '}\n                <ExternalLink href=\"https://uniswap.org/docs/v2/governance/governance-reference/#propose\">\n                  read the docs\n                </ExternalLink>\n                .\n              </Trans>\n            </ThemedText.Link>\n          </AutoColumn>\n        </BlueCard>\n\n        <ProposalActionSelector onClick={handleActionSelectorClick} proposalAction={proposalAction} />\n        <ProposalActionDetail\n          proposalAction={proposalAction}\n          currency={currencyValue}\n          amount={amountValue}\n          toAddress={toAddressValue}\n          onCurrencySelect={handleCurrencySelect}\n          onAmountInput={handleAmountInput}\n          onToAddressInput={handleToAddressInput}\n        />\n        <ProposalEditor\n          title={titleValue}\n          body={bodyValue}\n          onTitleInput={handleTitleInput}\n          onBodyInput={handleBodyInput}\n        />\n        <CreateProposalButton\n          proposalThreshold={proposalThreshold}\n          hasActiveOrPendingProposal={\n            latestProposalData?.status === ProposalState.ACTIVE || latestProposalData?.status === ProposalState.PENDING\n          }\n          hasEnoughVote={hasEnoughVote}\n          isFormInvalid={isFormInvalid}\n          handleCreateProposal={handleCreateProposal}\n        />\n        {!hasEnoughVote ? (\n          <AutonomousProposalCTA>\n            Don’t have 2.5M votes? Anyone can create an autonomous proposal using{' '}\n            <ExternalLink href=\"https://fish.vote\">fish.vote</ExternalLink>\n          </AutonomousProposalCTA>\n        ) : null}\n      </CreateProposalWrapper>\n      <ProposalActionSelectorModal\n        isOpen={modalOpen}\n        onDismiss={handleDismissActionSelector}\n        onProposalActionSelect={(proposalAction: ProposalAction) => handleActionChange(proposalAction)}\n      />\n      <ProposalSubmissionModal isOpen={attempting} hash={hash} onDismiss={handleDismissSubmissionModal} />\n    </AppBody>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}