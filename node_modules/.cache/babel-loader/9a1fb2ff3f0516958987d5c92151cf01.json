{"ast":null,"code":"import _regeneratorRuntime from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _createForOfIteratorHelper from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _asyncToGenerator from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { Token } from '@uniswap/sdk-core';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport { log } from '../util/log';\nimport { metric, MetricLoggerUnit } from '../util/metric';\nexport var CachingTokenListProvider = /*#__PURE__*/function () {\n  /**\n   * Creates an instance of CachingTokenListProvider.\n   * Token metadata (e.g. symbol and decimals) generally don't change so can be cached indefinitely.\n   *\n   * @param chainId The chain id to use.\n   * @param tokenList The token list to get the tokens from.\n   * @param tokenCache Cache instance to hold cached tokens.\n   */\n  function CachingTokenListProvider(chainId, tokenList, tokenCache) {\n    var _this = this;\n\n    _classCallCheck(this, CachingTokenListProvider);\n\n    this.tokenCache = tokenCache;\n\n    this.CACHE_KEY = function (tokenInfo) {\n      return \"token-list-token-\".concat(_this.chainId, \"/\").concat(_this.tokenList.name, \"/\").concat(_this.tokenList.timestamp, \"/\").concat(_this.tokenList.version, \"/\").concat(tokenInfo.address.toLowerCase(), \"/\").concat(tokenInfo.decimals, \"/\").concat(tokenInfo.symbol, \"/\").concat(tokenInfo.name);\n    };\n\n    this.chainId = chainId;\n    this.tokenList = tokenList;\n    this.chainToTokenInfos = _.reduce(this.tokenList.tokens, function (result, tokenInfo) {\n      var chainId = tokenInfo.chainId.toString();\n\n      if (!result[chainId]) {\n        result[chainId] = [];\n      }\n\n      result[chainId].push(tokenInfo);\n      return result;\n    }, {});\n    this.chainSymbolToTokenInfo = _.mapValues(this.chainToTokenInfos, function (tokenInfos) {\n      return _.keyBy(tokenInfos, 'symbol');\n    });\n    this.chainAddressToTokenInfo = _.mapValues(this.chainToTokenInfos, function (tokenInfos) {\n      return _.keyBy(tokenInfos, function (tokenInfo) {\n        return tokenInfo.address.toLowerCase();\n      });\n    });\n  }\n\n  _createClass(CachingTokenListProvider, [{\n    key: \"getTokens\",\n    value: function () {\n      var _getTokens = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_addresses) {\n        var addressToToken, symbolToToken, _iterator, _step, address, token;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                addressToToken = {};\n                symbolToToken = {};\n                _iterator = _createForOfIteratorHelper(_addresses);\n                _context.prev = 3;\n\n                _iterator.s();\n\n              case 5:\n                if ((_step = _iterator.n()).done) {\n                  _context.next = 18;\n                  break;\n                }\n\n                address = _step.value;\n                _context.next = 9;\n                return this.getTokenByAddress(address);\n\n              case 9:\n                token = _context.sent;\n\n                if (token) {\n                  _context.next = 12;\n                  break;\n                }\n\n                return _context.abrupt(\"continue\", 16);\n\n              case 12:\n                addressToToken[address.toLowerCase()] = token;\n\n                if (token.symbol) {\n                  _context.next = 15;\n                  break;\n                }\n\n                return _context.abrupt(\"continue\", 16);\n\n              case 15:\n                symbolToToken[token.symbol.toLowerCase()] = token;\n\n              case 16:\n                _context.next = 5;\n                break;\n\n              case 18:\n                _context.next = 23;\n                break;\n\n              case 20:\n                _context.prev = 20;\n                _context.t0 = _context[\"catch\"](3);\n\n                _iterator.e(_context.t0);\n\n              case 23:\n                _context.prev = 23;\n\n                _iterator.f();\n\n                return _context.finish(23);\n\n              case 26:\n                return _context.abrupt(\"return\", {\n                  getTokenByAddress: function getTokenByAddress(address) {\n                    return addressToToken[address.toLowerCase()];\n                  },\n                  getTokenBySymbol: function getTokenBySymbol(symbol) {\n                    return symbolToToken[symbol.toLowerCase()];\n                  },\n                  getAllTokens: function getAllTokens() {\n                    return Object.values(addressToToken);\n                  }\n                });\n\n              case 27:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 20, 23, 26]]);\n      }));\n\n      function getTokens(_x) {\n        return _getTokens.apply(this, arguments);\n      }\n\n      return getTokens;\n    }()\n  }, {\n    key: \"getTokenBySymbol\",\n    value: function () {\n      var _getTokenBySymbol = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_symbol) {\n        var symbol, tokenInfo, token;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                symbol = _symbol; // We consider ETH as a regular ERC20 Token throughout this package. We don't use the NativeCurrency object from the sdk.\n                // When we build the calldata for swapping we insert wrapping/unwrapping as needed.\n\n                if (_symbol == 'ETH') {\n                  symbol = 'WETH';\n                }\n\n                if (this.chainSymbolToTokenInfo[this.chainId.toString()]) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", undefined);\n\n              case 4:\n                tokenInfo = this.chainSymbolToTokenInfo[this.chainId.toString()][symbol];\n\n                if (tokenInfo) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", undefined);\n\n              case 7:\n                _context2.next = 9;\n                return this.buildToken(tokenInfo);\n\n              case 9:\n                token = _context2.sent;\n                return _context2.abrupt(\"return\", token);\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getTokenBySymbol(_x2) {\n        return _getTokenBySymbol.apply(this, arguments);\n      }\n\n      return getTokenBySymbol;\n    }()\n  }, {\n    key: \"getTokenByAddress\",\n    value: function () {\n      var _getTokenByAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(address) {\n        var tokenInfo, token;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (this.chainAddressToTokenInfo[this.chainId.toString()]) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", undefined);\n\n              case 2:\n                tokenInfo = this.chainAddressToTokenInfo[this.chainId.toString()][address.toLowerCase()];\n\n                if (tokenInfo) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", undefined);\n\n              case 5:\n                _context3.next = 7;\n                return this.buildToken(tokenInfo);\n\n              case 7:\n                token = _context3.sent;\n                return _context3.abrupt(\"return\", token);\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getTokenByAddress(_x3) {\n        return _getTokenByAddress.apply(this, arguments);\n      }\n\n      return getTokenByAddress;\n    }()\n  }, {\n    key: \"buildToken\",\n    value: function () {\n      var _buildToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(tokenInfo) {\n        var cacheKey, cachedToken, token;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                cacheKey = this.CACHE_KEY(tokenInfo);\n                _context4.next = 3;\n                return this.tokenCache.get(cacheKey);\n\n              case 3:\n                cachedToken = _context4.sent;\n\n                if (!cachedToken) {\n                  _context4.next = 6;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", cachedToken);\n\n              case 6:\n                token = new Token(this.chainId, tokenInfo.address, tokenInfo.decimals, tokenInfo.symbol, tokenInfo.name);\n                _context4.next = 9;\n                return this.tokenCache.set(cacheKey, token);\n\n              case 9:\n                return _context4.abrupt(\"return\", token);\n\n              case 10:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function buildToken(_x4) {\n        return _buildToken.apply(this, arguments);\n      }\n\n      return buildToken;\n    }()\n  }], [{\n    key: \"fromTokenListURI\",\n    value: function () {\n      var _fromTokenListURI = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(chainId, tokenListURI, tokenCache) {\n        var now, tokenList;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                now = Date.now();\n                _context5.next = 3;\n                return this.buildTokenList(tokenListURI);\n\n              case 3:\n                tokenList = _context5.sent;\n                metric.putMetric('TokenListLoad', Date.now() - now, MetricLoggerUnit.Milliseconds);\n                return _context5.abrupt(\"return\", new CachingTokenListProvider(chainId, tokenList, tokenCache));\n\n              case 6:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function fromTokenListURI(_x5, _x6, _x7) {\n        return _fromTokenListURI.apply(this, arguments);\n      }\n\n      return fromTokenListURI;\n    }()\n  }, {\n    key: \"buildTokenList\",\n    value: function () {\n      var _buildTokenList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(tokenListURI) {\n        var response, tokenList, status;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                log.info(\"Getting tokenList from \".concat(tokenListURI, \".\"));\n                _context6.next = 3;\n                return axios.get(tokenListURI);\n\n              case 3:\n                response = _context6.sent;\n                log.info(\"Got tokenList from \".concat(tokenListURI, \".\"));\n                tokenList = response.data, status = response.status;\n\n                if (!(status != 200)) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                log.error({\n                  response: response\n                }, \"Unabled to get token list from \".concat(tokenListURI, \".\"));\n                throw new Error(\"Unable to get token list from \".concat(tokenListURI));\n\n              case 9:\n                return _context6.abrupt(\"return\", tokenList);\n\n              case 10:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      function buildTokenList(_x8) {\n        return _buildTokenList.apply(this, arguments);\n      }\n\n      return buildTokenList;\n    }()\n  }, {\n    key: \"fromTokenList\",\n    value: function () {\n      var _fromTokenList = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(chainId, tokenList, tokenCache) {\n        var now, tokenProvider;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                now = Date.now();\n                tokenProvider = new CachingTokenListProvider(chainId, tokenList, tokenCache);\n                metric.putMetric('TokenListLoad', Date.now() - now, MetricLoggerUnit.Milliseconds);\n                return _context7.abrupt(\"return\", tokenProvider);\n\n              case 4:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }));\n\n      function fromTokenList(_x9, _x10, _x11) {\n        return _fromTokenList.apply(this, arguments);\n      }\n\n      return fromTokenList;\n    }()\n  }]);\n\n  return CachingTokenListProvider;\n}();","map":{"version":3,"sources":["../../../../src/providers/caching-token-list-provider.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { Token } from '@uniswap/sdk-core';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport { log } from '../util/log';\nimport { metric, MetricLoggerUnit } from '../util/metric';\nexport class CachingTokenListProvider {\n    /**\n     * Creates an instance of CachingTokenListProvider.\n     * Token metadata (e.g. symbol and decimals) generally don't change so can be cached indefinitely.\n     *\n     * @param chainId The chain id to use.\n     * @param tokenList The token list to get the tokens from.\n     * @param tokenCache Cache instance to hold cached tokens.\n     */\n    constructor(chainId, tokenList, tokenCache) {\n        this.tokenCache = tokenCache;\n        this.CACHE_KEY = (tokenInfo) => `token-list-token-${this.chainId}/${this.tokenList.name}/${this.tokenList.timestamp}/${this.tokenList.version}/${tokenInfo.address.toLowerCase()}/${tokenInfo.decimals}/${tokenInfo.symbol}/${tokenInfo.name}`;\n        this.chainId = chainId;\n        this.tokenList = tokenList;\n        this.chainToTokenInfos = _.reduce(this.tokenList.tokens, (result, tokenInfo) => {\n            const chainId = tokenInfo.chainId.toString();\n            if (!result[chainId]) {\n                result[chainId] = [];\n            }\n            result[chainId].push(tokenInfo);\n            return result;\n        }, {});\n        this.chainSymbolToTokenInfo = _.mapValues(this.chainToTokenInfos, (tokenInfos) => _.keyBy(tokenInfos, 'symbol'));\n        this.chainAddressToTokenInfo = _.mapValues(this.chainToTokenInfos, (tokenInfos) => _.keyBy(tokenInfos, (tokenInfo) => tokenInfo.address.toLowerCase()));\n    }\n    static async fromTokenListURI(chainId, tokenListURI, tokenCache) {\n        const now = Date.now();\n        const tokenList = await this.buildTokenList(tokenListURI);\n        metric.putMetric('TokenListLoad', Date.now() - now, MetricLoggerUnit.Milliseconds);\n        return new CachingTokenListProvider(chainId, tokenList, tokenCache);\n    }\n    static async buildTokenList(tokenListURI) {\n        log.info(`Getting tokenList from ${tokenListURI}.`);\n        const response = await axios.get(tokenListURI);\n        log.info(`Got tokenList from ${tokenListURI}.`);\n        const { data: tokenList, status } = response;\n        if (status != 200) {\n            log.error({ response }, `Unabled to get token list from ${tokenListURI}.`);\n            throw new Error(`Unable to get token list from ${tokenListURI}`);\n        }\n        return tokenList;\n    }\n    static async fromTokenList(chainId, tokenList, tokenCache) {\n        const now = Date.now();\n        const tokenProvider = new CachingTokenListProvider(chainId, tokenList, tokenCache);\n        metric.putMetric('TokenListLoad', Date.now() - now, MetricLoggerUnit.Milliseconds);\n        return tokenProvider;\n    }\n    async getTokens(_addresses) {\n        const addressToToken = {};\n        const symbolToToken = {};\n        for (const address of _addresses) {\n            const token = await this.getTokenByAddress(address);\n            if (!token) {\n                continue;\n            }\n            addressToToken[address.toLowerCase()] = token;\n            if (!token.symbol) {\n                continue;\n            }\n            symbolToToken[token.symbol.toLowerCase()] = token;\n        }\n        return {\n            getTokenByAddress: (address) => addressToToken[address.toLowerCase()],\n            getTokenBySymbol: (symbol) => symbolToToken[symbol.toLowerCase()],\n            getAllTokens: () => {\n                return Object.values(addressToToken);\n            },\n        };\n    }\n    async getTokenBySymbol(_symbol) {\n        let symbol = _symbol;\n        // We consider ETH as a regular ERC20 Token throughout this package. We don't use the NativeCurrency object from the sdk.\n        // When we build the calldata for swapping we insert wrapping/unwrapping as needed.\n        if (_symbol == 'ETH') {\n            symbol = 'WETH';\n        }\n        if (!this.chainSymbolToTokenInfo[this.chainId.toString()]) {\n            return undefined;\n        }\n        const tokenInfo = this.chainSymbolToTokenInfo[this.chainId.toString()][symbol];\n        if (!tokenInfo) {\n            return undefined;\n        }\n        const token = await this.buildToken(tokenInfo);\n        return token;\n    }\n    async getTokenByAddress(address) {\n        if (!this.chainAddressToTokenInfo[this.chainId.toString()]) {\n            return undefined;\n        }\n        const tokenInfo = this.chainAddressToTokenInfo[this.chainId.toString()][address.toLowerCase()];\n        if (!tokenInfo) {\n            return undefined;\n        }\n        const token = await this.buildToken(tokenInfo);\n        return token;\n    }\n    async buildToken(tokenInfo) {\n        const cacheKey = this.CACHE_KEY(tokenInfo);\n        const cachedToken = await this.tokenCache.get(cacheKey);\n        if (cachedToken) {\n            return cachedToken;\n        }\n        const token = new Token(this.chainId, tokenInfo.address, tokenInfo.decimals, tokenInfo.symbol, tokenInfo.name);\n        await this.tokenCache.set(cacheKey, token);\n        return token;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGluZy10b2tlbi1saXN0LXByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3Byb3ZpZGVycy9jYWNoaW5nLXRva2VuLWxpc3QtcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRTFDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMxQixPQUFPLENBQUMsTUFBTSxRQUFRLENBQUM7QUFFdkIsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNsQyxPQUFPLEVBQUUsTUFBTSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFxQjFELE1BQU0sT0FBTyx3QkFBd0I7SUFnQm5DOzs7Ozs7O09BT0c7SUFDSCxZQUNFLE9BQXlCLEVBQ3pCLFNBQW9CLEVBQ1osVUFBeUI7UUFBekIsZUFBVSxHQUFWLFVBQVUsQ0FBZTtRQXhCM0IsY0FBUyxHQUFHLENBQUMsU0FBb0IsRUFBRSxFQUFFLENBQzNDLG9CQUFvQixJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUNyRCxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQ2pCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLElBQUksU0FBUyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsSUFDM0QsU0FBUyxDQUFDLFFBQ1osSUFBSSxTQUFTLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQXFCekMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFFM0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQyxNQUFNLENBQy9CLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUNyQixDQUFDLE1BQTRCLEVB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"]},"metadata":{},"sourceType":"module"}