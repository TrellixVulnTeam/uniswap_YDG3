{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar _regeneratorRuntime = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _assertThisInitialized = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/assertThisInitialized\");\n\nvar _inherits = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLinkProvider = void 0;\n\nvar bn_js_1 = __importDefault(require(\"bn.js\"));\n\nvar WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\n\nvar init_1 = require(\"../init\");\n\nvar util_1 = require(\"../util\");\n\nvar eth_eip712_util_1 = __importDefault(require(\"../vendor-js/eth-eip712-util\"));\n\nvar FilterPolyfill_1 = require(\"./FilterPolyfill\");\n\nvar JSONRPC_1 = require(\"./JSONRPC\");\n\nvar eth_rpc_errors_1 = require(\"eth-rpc-errors\");\n\nvar safe_event_emitter_1 = __importDefault(require(\"@metamask/safe-event-emitter\"));\n\nvar SubscriptionManager_1 = require(\"./SubscriptionManager\");\n\nvar WalletLinkRelayAbstract_1 = require(\"../relay/WalletLinkRelayAbstract\");\n\nvar EthereumChain_1 = require(\"../EthereumChain\");\n\nvar Session_1 = require(\"../relay/Session\");\n\nvar DEFAULT_CHAIN_ID_KEY = \"DefaultChainId\"; // Indicates chain has been switched by switchEthereumChain or addEthereumChain request\n\nvar HAS_CHAIN_BEEN_SWITCHED_KEY = \"HasChainBeenSwitched\";\n\nvar WalletLinkProvider = /*#__PURE__*/function (_safe_event_emitter_) {\n  _inherits(WalletLinkProvider, _safe_event_emitter_);\n\n  var _super = _createSuper(WalletLinkProvider);\n\n  function WalletLinkProvider(options) {\n    var _this;\n\n    _classCallCheck(this, WalletLinkProvider);\n\n    _this = _super.call(this);\n    _this._filterPolyfill = new FilterPolyfill_1.FilterPolyfill(_assertThisInitialized(_this));\n    _this._subscriptionManager = new SubscriptionManager_1.SubscriptionManager(_assertThisInitialized(_this));\n    _this._relay = null;\n    _this._addresses = [];\n    _this.hasMadeFirstChainChangedEmission = false; // true if mobile client has sent message to override jsonRpcUrl+chainId\n\n    _this.isChainOverridden = false;\n    _this._send = _this.send;\n    _this._sendAsync = _this.sendAsync;\n    _this.setProviderInfo = _this.setProviderInfo.bind(_assertThisInitialized(_this));\n    _this.updateProviderInfo = _this.updateProviderInfo.bind(_assertThisInitialized(_this));\n    _this.getChainId = _this.getChainId.bind(_assertThisInitialized(_this));\n    _this.setAppInfo = _this.setAppInfo.bind(_assertThisInitialized(_this));\n    _this.enable = _this.enable.bind(_assertThisInitialized(_this));\n    _this.close = _this.close.bind(_assertThisInitialized(_this));\n    _this.send = _this.send.bind(_assertThisInitialized(_this));\n    _this.sendAsync = _this.sendAsync.bind(_assertThisInitialized(_this));\n    _this.request = _this.request.bind(_assertThisInitialized(_this));\n    _this._setAddresses = _this._setAddresses.bind(_assertThisInitialized(_this));\n    _this.scanQRCode = _this.scanQRCode.bind(_assertThisInitialized(_this));\n    _this.arbitraryRequest = _this.arbitraryRequest.bind(_assertThisInitialized(_this));\n    _this._jsonRpcUrl = options.jsonRpcUrl;\n    _this._overrideIsMetaMask = options.overrideIsMetaMask;\n    _this._relayProvider = options.relayProvider;\n    _this._storage = options.storage;\n    _this._relayEventManager = options.relayEventManager;\n    _this._walletLinkAnalytics = options.walletLinkAnalytics ? options.walletLinkAnalytics : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n\n    var chainId = _this.getChainId();\n\n    var chainIdStr = util_1.prepend0x(chainId.toString(16)); // indicate that we've connected, for EIP-1193 compliance\n\n    _this.emit(\"connect\", {\n      chainIdStr: chainIdStr\n    });\n\n    var cachedAddresses = _this._storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n\n    if (cachedAddresses) {\n      var addresses = cachedAddresses.split(\" \");\n\n      if (addresses[0] !== \"\") {\n        _this._addresses = addresses;\n\n        _this.emit(\"accountsChanged\", addresses);\n      }\n    }\n\n    _this._subscriptionManager.events.on(\"notification\", function (notification) {\n      _this.emit(\"message\", {\n        type: notification.method,\n        data: notification.params\n      });\n    });\n\n    if (_this._addresses.length > 0) {\n      _this.initializeRelay();\n    }\n\n    return _this;\n  }\n\n  _createClass(WalletLinkProvider, [{\n    key: \"selectedAddress\",\n    get: function get() {\n      return this._addresses[0] || undefined;\n    }\n  }, {\n    key: \"networkVersion\",\n    get: function get() {\n      return this.getChainId().toString(10);\n    }\n  }, {\n    key: \"chainId\",\n    get: function get() {\n      return util_1.prepend0x(this.getChainId().toString(16));\n    }\n  }, {\n    key: \"isWalletLink\",\n    get: function get() {\n      return true;\n    }\n    /**\n     * Some DApps (i.e. Alpha Homora) seem to require the window.ethereum object return\n     * true for this method.\n     */\n\n  }, {\n    key: \"isMetaMask\",\n    get: function get() {\n      return this._overrideIsMetaMask;\n    }\n  }, {\n    key: \"host\",\n    get: function get() {\n      return this._jsonRpcUrl;\n    }\n  }, {\n    key: \"connected\",\n    get: function get() {\n      return true;\n    }\n  }, {\n    key: \"isConnected\",\n    value: function isConnected() {\n      return true;\n    } // @ts-ignore\n\n  }, {\n    key: \"setProviderInfo\",\n    value: function setProviderInfo(jsonRpcUrl, chainId) {\n      if (this.isChainOverridden) return;\n      this.updateProviderInfo(jsonRpcUrl, this.getChainId(), false);\n    }\n  }, {\n    key: \"updateProviderInfo\",\n    value: function updateProviderInfo(jsonRpcUrl, chainId, fromRelay) {\n      var hasChainSwitched = this._storage.getItem(HAS_CHAIN_BEEN_SWITCHED_KEY) === \"true\";\n      if (hasChainSwitched && fromRelay) return;\n\n      if (fromRelay) {\n        this.isChainOverridden = true;\n      }\n\n      this._jsonRpcUrl = jsonRpcUrl; // emit chainChanged event if necessary\n\n      var originalChainId = this.getChainId();\n\n      this._storage.setItem(DEFAULT_CHAIN_ID_KEY, chainId.toString(10));\n\n      var chainChanged = util_1.ensureIntNumber(chainId) !== originalChainId;\n\n      if (chainChanged || !this.hasMadeFirstChainChangedEmission) {\n        this.emit(\"chainChanged\", this.getChainId());\n        this.hasMadeFirstChainChangedEmission = true;\n      }\n    }\n  }, {\n    key: \"switchEthereumChain\",\n    value: function () {\n      var _switchEthereumChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(rpcUrl, chainId) {\n        var relay, res;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(util_1.ensureIntNumber(chainId) === this.getChainId())) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                _context.next = 4;\n                return this.initializeRelay();\n\n              case 4:\n                relay = _context.sent;\n                _context.next = 7;\n                return relay.switchEthereumChain(chainId.toString(10)).promise;\n\n              case 7:\n                res = _context.sent;\n\n                if (res.result === true) {\n                  this._storage.setItem(HAS_CHAIN_BEEN_SWITCHED_KEY, \"true\");\n\n                  this.updateProviderInfo(rpcUrl, chainId, false);\n                }\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function switchEthereumChain(_x, _x2) {\n        return _switchEthereumChain.apply(this, arguments);\n      }\n\n      return switchEthereumChain;\n    }()\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.initializeRelay().then(function (relay) {\n        return relay.setAppInfo(appName, appLogoUrl);\n      });\n    }\n  }, {\n    key: \"enable\",\n    value: function () {\n      var _enable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this._walletLinkAnalytics.sendEvent(init_1.EVENTS.ETH_ACCOUNTS_STATE, {\n                  method: \"provider::enable\",\n                  addresses_length: this._addresses.length,\n                  sessionIdHash: this._relay ? Session_1.Session.hash(this._relay.session.id) : null\n                });\n\n                if (!(this._addresses.length > 0)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", this._addresses);\n\n              case 3:\n                _context2.next = 5;\n                return this._send(JSONRPC_1.JSONRPCMethod.eth_requestAccounts);\n\n              case 5:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function enable() {\n        return _enable.apply(this, arguments);\n      }\n\n      return enable;\n    }()\n  }, {\n    key: \"close\",\n    value: function close() {\n      this.initializeRelay().then(function (relay) {\n        return relay.resetAndReload();\n      });\n    }\n  }, {\n    key: \"send\",\n    value: function send(requestOrMethod, callbackOrParams) {\n      var _this2 = this;\n\n      // send<T>(method, params): Promise<T>\n      if (typeof requestOrMethod === \"string\") {\n        var method = requestOrMethod;\n        var params = Array.isArray(callbackOrParams) ? callbackOrParams : callbackOrParams !== undefined ? [callbackOrParams] : [];\n        var request = {\n          jsonrpc: \"2.0\",\n          id: 0,\n          method: method,\n          params: params\n        };\n        return this._sendRequestAsync(request).then(function (res) {\n          return res.result;\n        });\n      } // send(JSONRPCRequest | JSONRPCRequest[], callback): void\n\n\n      if (typeof callbackOrParams === \"function\") {\n        var _request = requestOrMethod;\n        var callback = callbackOrParams;\n        return this._sendAsync(_request, callback);\n      } // send(JSONRPCRequest[]): JSONRPCResponse[]\n\n\n      if (Array.isArray(requestOrMethod)) {\n        var requests = requestOrMethod;\n        return requests.map(function (r) {\n          return _this2._sendRequest(r);\n        });\n      } // send(JSONRPCRequest): JSONRPCResponse\n\n\n      var req = requestOrMethod;\n      return this._sendRequest(req);\n    }\n  }, {\n    key: \"sendAsync\",\n    value: function sendAsync(request, callback) {\n      if (typeof callback !== \"function\") {\n        throw new Error(\"callback is required\");\n      } // send(JSONRPCRequest[], callback): void\n\n\n      if (Array.isArray(request)) {\n        var arrayCb = callback;\n\n        this._sendMultipleRequestsAsync(request).then(function (responses) {\n          return arrayCb(null, responses);\n        }).catch(function (err) {\n          return arrayCb(err, null);\n        });\n\n        return;\n      } // send(JSONRPCRequest, callback): void\n\n\n      var cb = callback;\n\n      this._sendRequestAsync(request).then(function (response) {\n        return cb(null, response);\n      }).catch(function (err) {\n        return cb(err, null);\n      });\n    }\n  }, {\n    key: \"request\",\n    value: function () {\n      var _request2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(args) {\n        var method, params, newParams, id, result;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(!args || typeof args !== \"object\" || Array.isArray(args))) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                  message: \"Expected a single, non-array, object argument.\",\n                  data: args\n                });\n\n              case 2:\n                method = args.method, params = args.params;\n\n                if (!(typeof method !== \"string\" || method.length === 0)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                  message: \"'args.method' must be a non-empty string.\",\n                  data: args\n                });\n\n              case 5:\n                if (!(params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null))) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                  message: \"'args.params' must be an object or array if provided.\",\n                  data: args\n                });\n\n              case 7:\n                newParams = params === undefined ? [] : params; // WalletLink Requests\n\n                id = this._relayEventManager.makeRequestId();\n                _context3.next = 11;\n                return this._sendRequestAsync({\n                  method: method,\n                  params: newParams,\n                  jsonrpc: \"2.0\",\n                  id: id\n                });\n\n              case 11:\n                result = _context3.sent;\n                return _context3.abrupt(\"return\", result.result);\n\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function request(_x3) {\n        return _request2.apply(this, arguments);\n      }\n\n      return request;\n    }()\n  }, {\n    key: \"scanQRCode\",\n    value: function () {\n      var _scanQRCode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(match) {\n        var relay, res;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.initializeRelay();\n\n              case 2:\n                relay = _context4.sent;\n                _context4.next = 5;\n                return relay.scanQRCode(util_1.ensureRegExpString(match)).promise;\n\n              case 5:\n                res = _context4.sent;\n\n                if (!(typeof res.result !== \"string\")) {\n                  _context4.next = 8;\n                  break;\n                }\n\n                throw new Error(\"result was not a string\");\n\n              case 8:\n                return _context4.abrupt(\"return\", res.result);\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function scanQRCode(_x4) {\n        return _scanQRCode.apply(this, arguments);\n      }\n\n      return scanQRCode;\n    }()\n  }, {\n    key: \"arbitraryRequest\",\n    value: function () {\n      var _arbitraryRequest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(data) {\n        var relay, res;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.initializeRelay();\n\n              case 2:\n                relay = _context5.sent;\n                _context5.next = 5;\n                return relay.arbitraryRequest(data).promise;\n\n              case 5:\n                res = _context5.sent;\n\n                if (!(typeof res.result !== \"string\")) {\n                  _context5.next = 8;\n                  break;\n                }\n\n                throw new Error(\"result was not a string\");\n\n              case 8:\n                return _context5.abrupt(\"return\", res.result);\n\n              case 9:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function arbitraryRequest(_x5) {\n        return _arbitraryRequest.apply(this, arguments);\n      }\n\n      return arbitraryRequest;\n    }()\n  }, {\n    key: \"supportsSubscriptions\",\n    value: function supportsSubscriptions() {\n      return false;\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe() {\n      throw new Error(\"Subscriptions are not supported\");\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe() {\n      throw new Error(\"Subscriptions are not supported\");\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect() {\n      return true;\n    }\n  }, {\n    key: \"_sendRequest\",\n    value: function _sendRequest(request) {\n      var response = {\n        jsonrpc: \"2.0\",\n        id: request.id\n      };\n      var method = request.method;\n      response.result = this._handleSynchronousMethods(request);\n\n      if (response.result === undefined) {\n        throw new Error(\"WalletLink does not support calling \".concat(method, \" synchronously without \") + \"a callback. Please provide a callback parameter to call \".concat(method, \" \") + \"asynchronously.\");\n      }\n\n      return response;\n    }\n  }, {\n    key: \"_setAddresses\",\n    value: function _setAddresses(addresses) {\n      if (!Array.isArray(addresses)) {\n        throw new Error(\"addresses is not an array\");\n      }\n\n      var newAddresses = addresses.map(function (address) {\n        return util_1.ensureAddressString(address);\n      });\n\n      if (JSON.stringify(newAddresses) === JSON.stringify(this._addresses)) {\n        return;\n      }\n\n      this._addresses = newAddresses;\n      this.emit(\"accountsChanged\", this._addresses);\n\n      this._storage.setItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY, newAddresses.join(\" \"));\n\n      window.dispatchEvent(new CustomEvent(\"walletlink:addresses\", {\n        detail: this._addresses\n      }));\n    }\n  }, {\n    key: \"_sendRequestAsync\",\n    value: function _sendRequestAsync(request) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        try {\n          var syncResult = _this3._handleSynchronousMethods(request);\n\n          if (syncResult !== undefined) {\n            return resolve({\n              jsonrpc: \"2.0\",\n              id: request.id,\n              result: syncResult\n            });\n          }\n\n          var filterPromise = _this3._handleAsynchronousFilterMethods(request);\n\n          if (filterPromise !== undefined) {\n            filterPromise.then(function (res) {\n              return resolve(Object.assign(Object.assign({}, res), {\n                id: request.id\n              }));\n            }).catch(function (err) {\n              return reject(err);\n            });\n            return;\n          }\n\n          var subscriptionPromise = _this3._handleSubscriptionMethods(request);\n\n          if (subscriptionPromise !== undefined) {\n            subscriptionPromise.then(function (res) {\n              return resolve({\n                jsonrpc: \"2.0\",\n                id: request.id,\n                result: res.result\n              });\n            }).catch(function (err) {\n              return reject(err);\n            });\n            return;\n          }\n        } catch (err) {\n          return reject(err);\n        }\n\n        _this3._handleAsynchronousMethods(request).then(function (res) {\n          return resolve(Object.assign(Object.assign({}, res), {\n            id: request.id\n          }));\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n  }, {\n    key: \"_sendMultipleRequestsAsync\",\n    value: function _sendMultipleRequestsAsync(requests) {\n      var _this4 = this;\n\n      return Promise.all(requests.map(function (r) {\n        return _this4._sendRequestAsync(r);\n      }));\n    }\n  }, {\n    key: \"_handleSynchronousMethods\",\n    value: function _handleSynchronousMethods(request) {\n      var method = request.method;\n      var params = request.params || [];\n\n      switch (method) {\n        case JSONRPC_1.JSONRPCMethod.eth_accounts:\n          return this._eth_accounts();\n\n        case JSONRPC_1.JSONRPCMethod.eth_coinbase:\n          return this._eth_coinbase();\n\n        case JSONRPC_1.JSONRPCMethod.eth_uninstallFilter:\n          return this._eth_uninstallFilter(params);\n\n        case JSONRPC_1.JSONRPCMethod.net_version:\n          return this._net_version();\n\n        case JSONRPC_1.JSONRPCMethod.eth_chainId:\n          return this._eth_chainId();\n\n        default:\n          return undefined;\n      }\n    }\n  }, {\n    key: \"_handleAsynchronousMethods\",\n    value: function _handleAsynchronousMethods(request) {\n      var method = request.method;\n      var params = request.params || [];\n\n      switch (method) {\n        case JSONRPC_1.JSONRPCMethod.eth_requestAccounts:\n          return this._eth_requestAccounts();\n\n        case JSONRPC_1.JSONRPCMethod.eth_sign:\n          return this._eth_sign(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_ecRecover:\n          return this._eth_ecRecover(params);\n\n        case JSONRPC_1.JSONRPCMethod.personal_sign:\n          return this._personal_sign(params);\n\n        case JSONRPC_1.JSONRPCMethod.personal_ecRecover:\n          return this._personal_ecRecover(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_signTransaction:\n          return this._eth_signTransaction(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_sendRawTransaction:\n          return this._eth_sendRawTransaction(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_sendTransaction:\n          return this._eth_sendTransaction(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v1:\n          return this._eth_signTypedData_v1(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v2:\n          return this._throwUnsupportedMethodError();\n\n        case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v3:\n          return this._eth_signTypedData_v3(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v4:\n        case JSONRPC_1.JSONRPCMethod.eth_signTypedData:\n          return this._eth_signTypedData_v4(params);\n\n        case JSONRPC_1.JSONRPCMethod.walletlink_arbitrary:\n          return this._walletlink_arbitrary(params);\n\n        case JSONRPC_1.JSONRPCMethod.wallet_addEthereumChain:\n          return this._wallet_addEthereumChain(params);\n\n        case JSONRPC_1.JSONRPCMethod.wallet_switchEthereumChain:\n          return this._wallet_switchEthereumChain(params);\n      }\n\n      if (!this._jsonRpcUrl) throw Error(\"Error: No jsonRpcUrl provided\");\n      return window.fetch(this._jsonRpcUrl, {\n        method: \"POST\",\n        body: JSON.stringify(request),\n        mode: \"cors\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (!json) {\n          throw eth_rpc_errors_1.ethErrors.rpc.parse({});\n        }\n\n        var response = json;\n        var error = response.error;\n\n        if (error) {\n          throw eth_rpc_errors_1.serializeError(error);\n        }\n\n        return response;\n      });\n    }\n  }, {\n    key: \"_handleAsynchronousFilterMethods\",\n    value: function _handleAsynchronousFilterMethods(request) {\n      var method = request.method;\n      var params = request.params || [];\n\n      switch (method) {\n        case JSONRPC_1.JSONRPCMethod.eth_newFilter:\n          return this._eth_newFilter(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_newBlockFilter:\n          return this._eth_newBlockFilter();\n\n        case JSONRPC_1.JSONRPCMethod.eth_newPendingTransactionFilter:\n          return this._eth_newPendingTransactionFilter();\n\n        case JSONRPC_1.JSONRPCMethod.eth_getFilterChanges:\n          return this._eth_getFilterChanges(params);\n\n        case JSONRPC_1.JSONRPCMethod.eth_getFilterLogs:\n          return this._eth_getFilterLogs(params);\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"_handleSubscriptionMethods\",\n    value: function _handleSubscriptionMethods(request) {\n      switch (request.method) {\n        case JSONRPC_1.JSONRPCMethod.eth_subscribe:\n        case JSONRPC_1.JSONRPCMethod.eth_unsubscribe:\n          return this._subscriptionManager.handleRequest(request);\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"_isKnownAddress\",\n    value: function _isKnownAddress(addressString) {\n      try {\n        var address = util_1.ensureAddressString(addressString);\n        return this._addresses.includes(address);\n      } catch (_a) {}\n\n      return false;\n    }\n  }, {\n    key: \"_ensureKnownAddress\",\n    value: function _ensureKnownAddress(addressString) {\n      if (!this._isKnownAddress(addressString)) {\n        throw new Error(\"Unknown Ethereum address\");\n      }\n    }\n  }, {\n    key: \"_prepareTransactionParams\",\n    value: function _prepareTransactionParams(tx) {\n      var fromAddress = tx.from ? util_1.ensureAddressString(tx.from) : this.selectedAddress;\n\n      if (!fromAddress) {\n        throw new Error(\"Ethereum address is unavailable\");\n      }\n\n      this._ensureKnownAddress(fromAddress);\n\n      var toAddress = tx.to ? util_1.ensureAddressString(tx.to) : null;\n      var weiValue = tx.value != null ? util_1.ensureBN(tx.value) : new bn_js_1.default(0);\n      var data = tx.data ? util_1.ensureBuffer(tx.data) : Buffer.alloc(0);\n      var nonce = tx.nonce != null ? util_1.ensureIntNumber(tx.nonce) : null;\n      var gasPriceInWei = tx.gasPrice != null ? util_1.ensureBN(tx.gasPrice) : null;\n      var maxFeePerGas = tx.maxFeePerGas != null ? util_1.ensureBN(tx.maxFeePerGas) : null;\n      var maxPriorityFeePerGas = tx.maxPriorityFeePerGas != null ? util_1.ensureBN(tx.maxPriorityFeePerGas) : null;\n      var gasLimit = tx.gas != null ? util_1.ensureBN(tx.gas) : null;\n      var chainId = this.getChainId();\n      return {\n        fromAddress: fromAddress,\n        toAddress: toAddress,\n        weiValue: weiValue,\n        data: data,\n        nonce: nonce,\n        gasPriceInWei: gasPriceInWei,\n        maxFeePerGas: maxFeePerGas,\n        maxPriorityFeePerGas: maxPriorityFeePerGas,\n        gasLimit: gasLimit,\n        chainId: chainId\n      };\n    }\n  }, {\n    key: \"_requireAuthorization\",\n    value: function _requireAuthorization() {\n      if (this._addresses.length === 0) {\n        throw eth_rpc_errors_1.ethErrors.provider.unauthorized({});\n      }\n    }\n  }, {\n    key: \"_throwUnsupportedMethodError\",\n    value: function _throwUnsupportedMethodError() {\n      throw eth_rpc_errors_1.ethErrors.provider.unsupportedMethod({});\n    }\n  }, {\n    key: \"_signEthereumMessage\",\n    value: function () {\n      var _signEthereumMessage2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(message, address, addPrefix, typedDataJson) {\n        var relay, res;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                this._ensureKnownAddress(address);\n\n                _context6.prev = 1;\n                _context6.next = 4;\n                return this.initializeRelay();\n\n              case 4:\n                relay = _context6.sent;\n                _context6.next = 7;\n                return relay.signEthereumMessage(message, address, addPrefix, typedDataJson).promise;\n\n              case 7:\n                res = _context6.sent;\n                return _context6.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: res.result\n                });\n\n              case 11:\n                _context6.prev = 11;\n                _context6.t0 = _context6[\"catch\"](1);\n\n                if (!(typeof _context6.t0.message === \"string\" && _context6.t0.message.match(/(denied|rejected)/i))) {\n                  _context6.next = 15;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied message signature\");\n\n              case 15:\n                throw _context6.t0;\n\n              case 16:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[1, 11]]);\n      }));\n\n      function _signEthereumMessage(_x6, _x7, _x8, _x9) {\n        return _signEthereumMessage2.apply(this, arguments);\n      }\n\n      return _signEthereumMessage;\n    }()\n  }, {\n    key: \"_ethereumAddressFromSignedMessage\",\n    value: function () {\n      var _ethereumAddressFromSignedMessage2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(message, signature, addPrefix) {\n        var relay, res;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.initializeRelay();\n\n              case 2:\n                relay = _context7.sent;\n                _context7.next = 5;\n                return relay.ethereumAddressFromSignedMessage(message, signature, addPrefix).promise;\n\n              case 5:\n                res = _context7.sent;\n                return _context7.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: res.result\n                });\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function _ethereumAddressFromSignedMessage(_x10, _x11, _x12) {\n        return _ethereumAddressFromSignedMessage2.apply(this, arguments);\n      }\n\n      return _ethereumAddressFromSignedMessage;\n    }()\n  }, {\n    key: \"_eth_accounts\",\n    value: function _eth_accounts() {\n      return this._addresses;\n    }\n  }, {\n    key: \"_eth_coinbase\",\n    value: function _eth_coinbase() {\n      return this.selectedAddress || null;\n    }\n  }, {\n    key: \"_net_version\",\n    value: function _net_version() {\n      return this.getChainId().toString(10);\n    }\n  }, {\n    key: \"_eth_chainId\",\n    value: function _eth_chainId() {\n      return util_1.hexStringFromIntNumber(this.getChainId());\n    }\n  }, {\n    key: \"getChainId\",\n    value: function getChainId() {\n      var chainIdStr = this._storage.getItem(DEFAULT_CHAIN_ID_KEY) || \"1\";\n      var chainId = parseInt(chainIdStr, 10);\n      return util_1.ensureIntNumber(chainId);\n    }\n  }, {\n    key: \"_eth_requestAccounts\",\n    value: function () {\n      var _eth_requestAccounts2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        var res, relay;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                this._walletLinkAnalytics.sendEvent(init_1.EVENTS.ETH_ACCOUNTS_STATE, {\n                  method: \"provider::_eth_requestAccounts\",\n                  addresses_length: this._addresses.length,\n                  sessionIdHash: this._relay ? Session_1.Session.hash(this._relay.session.id) : null\n                });\n\n                if (!(this._addresses.length > 0)) {\n                  _context8.next = 3;\n                  break;\n                }\n\n                return _context8.abrupt(\"return\", Promise.resolve({\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: this._addresses\n                }));\n\n              case 3:\n                _context8.prev = 3;\n                _context8.next = 6;\n                return this.initializeRelay();\n\n              case 6:\n                relay = _context8.sent;\n                _context8.next = 9;\n                return relay.requestEthereumAccounts().promise;\n\n              case 9:\n                res = _context8.sent;\n                _context8.next = 17;\n                break;\n\n              case 12:\n                _context8.prev = 12;\n                _context8.t0 = _context8[\"catch\"](3);\n\n                if (!(typeof _context8.t0.message === \"string\" && _context8.t0.message.match(/(denied|rejected)/i))) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied account authorization\");\n\n              case 16:\n                throw _context8.t0;\n\n              case 17:\n                if (res.result) {\n                  _context8.next = 19;\n                  break;\n                }\n\n                throw new Error(\"accounts received is empty\");\n\n              case 19:\n                this._setAddresses(res.result);\n\n                return _context8.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: this._addresses\n                });\n\n              case 21:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[3, 12]]);\n      }));\n\n      function _eth_requestAccounts() {\n        return _eth_requestAccounts2.apply(this, arguments);\n      }\n\n      return _eth_requestAccounts;\n    }()\n  }, {\n    key: \"_eth_sign\",\n    value: function _eth_sign(params) {\n      this._requireAuthorization();\n\n      var address = util_1.ensureAddressString(params[0]);\n      var message = util_1.ensureBuffer(params[1]);\n      return this._signEthereumMessage(message, address, false);\n    }\n  }, {\n    key: \"_eth_ecRecover\",\n    value: function _eth_ecRecover(params) {\n      var message = util_1.ensureBuffer(params[0]);\n      var signature = util_1.ensureBuffer(params[1]);\n      return this._ethereumAddressFromSignedMessage(message, signature, false);\n    }\n  }, {\n    key: \"_personal_sign\",\n    value: function _personal_sign(params) {\n      this._requireAuthorization();\n\n      var message = util_1.ensureBuffer(params[0]);\n      var address = util_1.ensureAddressString(params[1]);\n      return this._signEthereumMessage(message, address, true);\n    }\n  }, {\n    key: \"_personal_ecRecover\",\n    value: function _personal_ecRecover(params) {\n      var message = util_1.ensureBuffer(params[0]);\n      var signature = util_1.ensureBuffer(params[1]);\n      return this._ethereumAddressFromSignedMessage(message, signature, true);\n    }\n  }, {\n    key: \"_eth_signTransaction\",\n    value: function () {\n      var _eth_signTransaction2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(params) {\n        var tx, relay, res;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                this._requireAuthorization();\n\n                tx = this._prepareTransactionParams(params[0] || {});\n                _context9.prev = 2;\n                _context9.next = 5;\n                return this.initializeRelay();\n\n              case 5:\n                relay = _context9.sent;\n                _context9.next = 8;\n                return relay.signEthereumTransaction(tx).promise;\n\n              case 8:\n                res = _context9.sent;\n                return _context9.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: res.result\n                });\n\n              case 12:\n                _context9.prev = 12;\n                _context9.t0 = _context9[\"catch\"](2);\n\n                if (!(typeof _context9.t0.message === \"string\" && _context9.t0.message.match(/(denied|rejected)/i))) {\n                  _context9.next = 16;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied transaction signature\");\n\n              case 16:\n                throw _context9.t0;\n\n              case 17:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this, [[2, 12]]);\n      }));\n\n      function _eth_signTransaction(_x13) {\n        return _eth_signTransaction2.apply(this, arguments);\n      }\n\n      return _eth_signTransaction;\n    }()\n  }, {\n    key: \"_eth_sendRawTransaction\",\n    value: function () {\n      var _eth_sendRawTransaction2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(params) {\n        var signedTransaction, relay, res;\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                signedTransaction = util_1.ensureBuffer(params[0]);\n                _context10.next = 3;\n                return this.initializeRelay();\n\n              case 3:\n                relay = _context10.sent;\n                _context10.next = 6;\n                return relay.submitEthereumTransaction(signedTransaction, this.getChainId()).promise;\n\n              case 6:\n                res = _context10.sent;\n                return _context10.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: res.result\n                });\n\n              case 8:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function _eth_sendRawTransaction(_x14) {\n        return _eth_sendRawTransaction2.apply(this, arguments);\n      }\n\n      return _eth_sendRawTransaction;\n    }()\n  }, {\n    key: \"_eth_sendTransaction\",\n    value: function () {\n      var _eth_sendTransaction2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(params) {\n        var tx, relay, res;\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                this._requireAuthorization();\n\n                tx = this._prepareTransactionParams(params[0] || {});\n                _context11.prev = 2;\n                _context11.next = 5;\n                return this.initializeRelay();\n\n              case 5:\n                relay = _context11.sent;\n                _context11.next = 8;\n                return relay.signAndSubmitEthereumTransaction(tx).promise;\n\n              case 8:\n                res = _context11.sent;\n                return _context11.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: res.result\n                });\n\n              case 12:\n                _context11.prev = 12;\n                _context11.t0 = _context11[\"catch\"](2);\n\n                if (!(typeof _context11.t0.message === \"string\" && _context11.t0.message.match(/(denied|rejected)/i))) {\n                  _context11.next = 16;\n                  break;\n                }\n\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied transaction signature\");\n\n              case 16:\n                throw _context11.t0;\n\n              case 17:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this, [[2, 12]]);\n      }));\n\n      function _eth_sendTransaction(_x15) {\n        return _eth_sendTransaction2.apply(this, arguments);\n      }\n\n      return _eth_sendTransaction;\n    }()\n  }, {\n    key: \"_eth_signTypedData_v1\",\n    value: function () {\n      var _eth_signTypedData_v = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12(params) {\n        var typedData, address, message, typedDataJSON;\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                this._requireAuthorization();\n\n                typedData = util_1.ensureParsedJSONObject(params[0]);\n                address = util_1.ensureAddressString(params[1]);\n\n                this._ensureKnownAddress(address);\n\n                message = eth_eip712_util_1.default.hashForSignTypedDataLegacy({\n                  data: typedData\n                });\n                typedDataJSON = JSON.stringify(typedData, null, 2);\n                return _context12.abrupt(\"return\", this._signEthereumMessage(message, address, false, typedDataJSON));\n\n              case 7:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function _eth_signTypedData_v1(_x16) {\n        return _eth_signTypedData_v.apply(this, arguments);\n      }\n\n      return _eth_signTypedData_v1;\n    }()\n  }, {\n    key: \"_eth_signTypedData_v3\",\n    value: function () {\n      var _eth_signTypedData_v2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(params) {\n        var address, typedData, message, typedDataJSON;\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                this._requireAuthorization();\n\n                address = util_1.ensureAddressString(params[0]);\n                typedData = util_1.ensureParsedJSONObject(params[1]);\n\n                this._ensureKnownAddress(address);\n\n                message = eth_eip712_util_1.default.hashForSignTypedData_v3({\n                  data: typedData\n                });\n                typedDataJSON = JSON.stringify(typedData, null, 2);\n                return _context13.abrupt(\"return\", this._signEthereumMessage(message, address, false, typedDataJSON));\n\n              case 7:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function _eth_signTypedData_v3(_x17) {\n        return _eth_signTypedData_v2.apply(this, arguments);\n      }\n\n      return _eth_signTypedData_v3;\n    }()\n  }, {\n    key: \"_eth_signTypedData_v4\",\n    value: function () {\n      var _eth_signTypedData_v5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(params) {\n        var address, typedData, message, typedDataJSON;\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                this._requireAuthorization();\n\n                address = util_1.ensureAddressString(params[0]);\n                typedData = util_1.ensureParsedJSONObject(params[1]);\n\n                this._ensureKnownAddress(address);\n\n                message = eth_eip712_util_1.default.hashForSignTypedData_v4({\n                  data: typedData\n                });\n                typedDataJSON = JSON.stringify(typedData, null, 2);\n                return _context14.abrupt(\"return\", this._signEthereumMessage(message, address, false, typedDataJSON));\n\n              case 7:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function _eth_signTypedData_v4(_x18) {\n        return _eth_signTypedData_v5.apply(this, arguments);\n      }\n\n      return _eth_signTypedData_v4;\n    }()\n  }, {\n    key: \"_walletlink_arbitrary\",\n    value: function () {\n      var _walletlink_arbitrary2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15(params) {\n        var data, result;\n        return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                data = params[0];\n\n                if (!(typeof data !== \"string\")) {\n                  _context15.next = 3;\n                  break;\n                }\n\n                throw new Error(\"parameter must be a string\");\n\n              case 3:\n                _context15.next = 5;\n                return this.arbitraryRequest(data);\n\n              case 5:\n                result = _context15.sent;\n                return _context15.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: result\n                });\n\n              case 7:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n\n      function _walletlink_arbitrary(_x19) {\n        return _walletlink_arbitrary2.apply(this, arguments);\n      }\n\n      return _walletlink_arbitrary;\n    }()\n  }, {\n    key: \"_wallet_addEthereumChain\",\n    value: function () {\n      var _wallet_addEthereumChain2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16(params) {\n        var request, chainIdNumber, ethereumChain, rpcUrl;\n        return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                request = params[0];\n                chainIdNumber = parseInt(request.chainId, 16);\n                ethereumChain = EthereumChain_1.EthereumChain.fromChainId(BigInt(chainIdNumber));\n\n                if (!(ethereumChain === undefined)) {\n                  _context16.next = 5;\n                  break;\n                }\n\n                return _context16.abrupt(\"return\", {\n                  jsonrpc: '2.0',\n                  id: 0,\n                  error: {\n                    code: 2,\n                    message: \"chainId \".concat(request.chainId, \" not supported\")\n                  }\n                });\n\n              case 5:\n                rpcUrl = EthereumChain_1.EthereumChain.rpcUrl(ethereumChain); // @ts-ignore\n\n                _context16.next = 8;\n                return this.switchEthereumChain(rpcUrl, parseInt(request.chainId, 16));\n\n              case 8:\n                return _context16.abrupt(\"return\", {\n                  jsonrpc: '2.0',\n                  id: 0,\n                  result: null\n                });\n\n              case 9:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n\n      function _wallet_addEthereumChain(_x20) {\n        return _wallet_addEthereumChain2.apply(this, arguments);\n      }\n\n      return _wallet_addEthereumChain;\n    }()\n  }, {\n    key: \"_wallet_switchEthereumChain\",\n    value: function () {\n      var _wallet_switchEthereumChain2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee17(params) {\n        var request, chainIdNumber, ethereumChain, rpcUrl;\n        return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                request = params[0];\n                chainIdNumber = parseInt(request.chainId, 16);\n                ethereumChain = EthereumChain_1.EthereumChain.fromChainId(BigInt(chainIdNumber));\n\n                if (!(ethereumChain === undefined)) {\n                  _context17.next = 5;\n                  break;\n                }\n\n                return _context17.abrupt(\"return\", {\n                  jsonrpc: '2.0',\n                  id: 0,\n                  error: {\n                    code: 2,\n                    message: \"chainId \".concat(request.chainId, \" not supported\")\n                  }\n                });\n\n              case 5:\n                rpcUrl = EthereumChain_1.EthereumChain.rpcUrl(ethereumChain); // @ts-ignore\n\n                _context17.next = 8;\n                return this.switchEthereumChain(rpcUrl, parseInt(request.chainId, 16));\n\n              case 8:\n                return _context17.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: null\n                });\n\n              case 9:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n\n      function _wallet_switchEthereumChain(_x21) {\n        return _wallet_switchEthereumChain2.apply(this, arguments);\n      }\n\n      return _wallet_switchEthereumChain;\n    }()\n  }, {\n    key: \"_eth_uninstallFilter\",\n    value: function _eth_uninstallFilter(params) {\n      var filterId = util_1.ensureHexString(params[0]);\n      return this._filterPolyfill.uninstallFilter(filterId);\n    }\n  }, {\n    key: \"_eth_newFilter\",\n    value: function () {\n      var _eth_newFilter2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee18(params) {\n        var param, filterId;\n        return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                param = params[0];\n                _context18.next = 3;\n                return this._filterPolyfill.newFilter(param);\n\n              case 3:\n                filterId = _context18.sent;\n                return _context18.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: filterId\n                });\n\n              case 5:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function _eth_newFilter(_x22) {\n        return _eth_newFilter2.apply(this, arguments);\n      }\n\n      return _eth_newFilter;\n    }()\n  }, {\n    key: \"_eth_newBlockFilter\",\n    value: function () {\n      var _eth_newBlockFilter2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee19() {\n        var filterId;\n        return _regeneratorRuntime.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return this._filterPolyfill.newBlockFilter();\n\n              case 2:\n                filterId = _context19.sent;\n                return _context19.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: filterId\n                });\n\n              case 4:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n\n      function _eth_newBlockFilter() {\n        return _eth_newBlockFilter2.apply(this, arguments);\n      }\n\n      return _eth_newBlockFilter;\n    }()\n  }, {\n    key: \"_eth_newPendingTransactionFilter\",\n    value: function () {\n      var _eth_newPendingTransactionFilter2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee20() {\n        var filterId;\n        return _regeneratorRuntime.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return this._filterPolyfill.newPendingTransactionFilter();\n\n              case 2:\n                filterId = _context20.sent;\n                return _context20.abrupt(\"return\", {\n                  jsonrpc: \"2.0\",\n                  id: 0,\n                  result: filterId\n                });\n\n              case 4:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n\n      function _eth_newPendingTransactionFilter() {\n        return _eth_newPendingTransactionFilter2.apply(this, arguments);\n      }\n\n      return _eth_newPendingTransactionFilter;\n    }()\n  }, {\n    key: \"_eth_getFilterChanges\",\n    value: function _eth_getFilterChanges(params) {\n      var filterId = util_1.ensureHexString(params[0]);\n      return this._filterPolyfill.getFilterChanges(filterId);\n    }\n  }, {\n    key: \"_eth_getFilterLogs\",\n    value: function _eth_getFilterLogs(params) {\n      var filterId = util_1.ensureHexString(params[0]);\n      return this._filterPolyfill.getFilterLogs(filterId);\n    }\n  }, {\n    key: \"initializeRelay\",\n    value: function initializeRelay() {\n      var _this5 = this;\n\n      if (this._relay) {\n        return Promise.resolve(this._relay);\n      }\n\n      return this._relayProvider().then(function (relay) {\n        relay.setAccountsCallback(function (accounts) {\n          return _this5._setAddresses(accounts);\n        });\n        relay.setChainIdCallback(function (chainId) {\n          _this5.updateProviderInfo(_this5._jsonRpcUrl, parseInt(chainId, 10), true);\n        });\n        relay.setJsonRpcUrlCallback(function (jsonRpcUrl) {\n          _this5.updateProviderInfo(jsonRpcUrl, _this5.getChainId(), true);\n        });\n        _this5._relay = relay;\n        return relay;\n      });\n    }\n  }]);\n\n  return WalletLinkProvider;\n}(safe_event_emitter_1.default);\n\nexports.WalletLinkProvider = WalletLinkProvider;","map":{"version":3,"sources":["/Users/safahi/Downloads/interface-4.30.1/node_modules/walletlink/dist/provider/WalletLinkProvider.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","WalletLinkProvider","bn_js_1","require","WalletLinkAnalytics_1","init_1","util_1","eth_eip712_util_1","FilterPolyfill_1","JSONRPC_1","eth_rpc_errors_1","safe_event_emitter_1","SubscriptionManager_1","WalletLinkRelayAbstract_1","EthereumChain_1","Session_1","DEFAULT_CHAIN_ID_KEY","HAS_CHAIN_BEEN_SWITCHED_KEY","options","_filterPolyfill","FilterPolyfill","_subscriptionManager","SubscriptionManager","_relay","_addresses","hasMadeFirstChainChangedEmission","isChainOverridden","_send","send","_sendAsync","sendAsync","setProviderInfo","bind","updateProviderInfo","getChainId","setAppInfo","enable","close","request","_setAddresses","scanQRCode","arbitraryRequest","_jsonRpcUrl","jsonRpcUrl","_overrideIsMetaMask","overrideIsMetaMask","_relayProvider","relayProvider","_storage","storage","_relayEventManager","relayEventManager","_walletLinkAnalytics","walletLinkAnalytics","WalletLinkAnalytics","chainId","chainIdStr","prepend0x","toString","emit","cachedAddresses","getItem","LOCAL_STORAGE_ADDRESSES_KEY","addresses","split","events","on","notification","type","method","data","params","length","initializeRelay","undefined","fromRelay","hasChainSwitched","originalChainId","setItem","chainChanged","ensureIntNumber","rpcUrl","relay","switchEthereumChain","promise","res","result","appName","appLogoUrl","then","sendEvent","EVENTS","ETH_ACCOUNTS_STATE","addresses_length","sessionIdHash","Session","hash","session","id","JSONRPCMethod","eth_requestAccounts","resetAndReload","requestOrMethod","callbackOrParams","Array","isArray","jsonrpc","_sendRequestAsync","callback","requests","map","r","_sendRequest","req","Error","arrayCb","_sendMultipleRequestsAsync","responses","catch","err","cb","response","args","ethErrors","rpc","invalidRequest","message","newParams","makeRequestId","match","ensureRegExpString","_handleSynchronousMethods","newAddresses","address","ensureAddressString","JSON","stringify","join","window","dispatchEvent","CustomEvent","detail","Promise","resolve","reject","syncResult","filterPromise","_handleAsynchronousFilterMethods","assign","subscriptionPromise","_handleSubscriptionMethods","_handleAsynchronousMethods","all","eth_accounts","_eth_accounts","eth_coinbase","_eth_coinbase","eth_uninstallFilter","_eth_uninstallFilter","net_version","_net_version","eth_chainId","_eth_chainId","_eth_requestAccounts","eth_sign","_eth_sign","eth_ecRecover","_eth_ecRecover","personal_sign","_personal_sign","personal_ecRecover","_personal_ecRecover","eth_signTransaction","_eth_signTransaction","eth_sendRawTransaction","_eth_sendRawTransaction","eth_sendTransaction","_eth_sendTransaction","eth_signTypedData_v1","_eth_signTypedData_v1","eth_signTypedData_v2","_throwUnsupportedMethodError","eth_signTypedData_v3","_eth_signTypedData_v3","eth_signTypedData_v4","eth_signTypedData","_eth_signTypedData_v4","walletlink_arbitrary","_walletlink_arbitrary","wallet_addEthereumChain","_wallet_addEthereumChain","wallet_switchEthereumChain","_wallet_switchEthereumChain","fetch","body","mode","headers","json","parse","error","serializeError","eth_newFilter","_eth_newFilter","eth_newBlockFilter","_eth_newBlockFilter","eth_newPendingTransactionFilter","_eth_newPendingTransactionFilter","eth_getFilterChanges","_eth_getFilterChanges","eth_getFilterLogs","_eth_getFilterLogs","eth_subscribe","eth_unsubscribe","handleRequest","addressString","includes","_a","_isKnownAddress","tx","fromAddress","from","selectedAddress","_ensureKnownAddress","toAddress","to","weiValue","ensureBN","default","ensureBuffer","Buffer","alloc","nonce","gasPriceInWei","gasPrice","maxFeePerGas","maxPriorityFeePerGas","gasLimit","gas","provider","unauthorized","unsupportedMethod","addPrefix","typedDataJson","signEthereumMessage","userRejectedRequest","signature","ethereumAddressFromSignedMessage","hexStringFromIntNumber","parseInt","requestEthereumAccounts","_requireAuthorization","_signEthereumMessage","_ethereumAddressFromSignedMessage","_prepareTransactionParams","signEthereumTransaction","signedTransaction","submitEthereumTransaction","signAndSubmitEthereumTransaction","typedData","ensureParsedJSONObject","hashForSignTypedDataLegacy","typedDataJSON","hashForSignTypedData_v3","hashForSignTypedData_v4","chainIdNumber","ethereumChain","EthereumChain","fromChainId","BigInt","code","filterId","ensureHexString","uninstallFilter","param","newFilter","newBlockFilter","newPendingTransactionFilter","getFilterChanges","getFilterLogs","setAccountsCallback","accounts","setChainIdCallback","setJsonRpcUrlCallback"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletLinkProvider = void 0;\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\nconst init_1 = require(\"../init\");\nconst util_1 = require(\"../util\");\nconst eth_eip712_util_1 = __importDefault(require(\"../vendor-js/eth-eip712-util\"));\nconst FilterPolyfill_1 = require(\"./FilterPolyfill\");\nconst JSONRPC_1 = require(\"./JSONRPC\");\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nconst safe_event_emitter_1 = __importDefault(require(\"@metamask/safe-event-emitter\"));\nconst SubscriptionManager_1 = require(\"./SubscriptionManager\");\nconst WalletLinkRelayAbstract_1 = require(\"../relay/WalletLinkRelayAbstract\");\nconst EthereumChain_1 = require(\"../EthereumChain\");\nconst Session_1 = require(\"../relay/Session\");\nconst DEFAULT_CHAIN_ID_KEY = \"DefaultChainId\";\n// Indicates chain has been switched by switchEthereumChain or addEthereumChain request\nconst HAS_CHAIN_BEEN_SWITCHED_KEY = \"HasChainBeenSwitched\";\nclass WalletLinkProvider extends safe_event_emitter_1.default {\n    constructor(options) {\n        super();\n        this._filterPolyfill = new FilterPolyfill_1.FilterPolyfill(this);\n        this._subscriptionManager = new SubscriptionManager_1.SubscriptionManager(this);\n        this._relay = null;\n        this._addresses = [];\n        this.hasMadeFirstChainChangedEmission = false;\n        // true if mobile client has sent message to override jsonRpcUrl+chainId\n        this.isChainOverridden = false;\n        this._send = this.send;\n        this._sendAsync = this.sendAsync;\n        this.setProviderInfo = this.setProviderInfo.bind(this);\n        this.updateProviderInfo = this.updateProviderInfo.bind(this);\n        this.getChainId = this.getChainId.bind(this);\n        this.setAppInfo = this.setAppInfo.bind(this);\n        this.enable = this.enable.bind(this);\n        this.close = this.close.bind(this);\n        this.send = this.send.bind(this);\n        this.sendAsync = this.sendAsync.bind(this);\n        this.request = this.request.bind(this);\n        this._setAddresses = this._setAddresses.bind(this);\n        this.scanQRCode = this.scanQRCode.bind(this);\n        this.arbitraryRequest = this.arbitraryRequest.bind(this);\n        this._jsonRpcUrl = options.jsonRpcUrl;\n        this._overrideIsMetaMask = options.overrideIsMetaMask;\n        this._relayProvider = options.relayProvider;\n        this._storage = options.storage;\n        this._relayEventManager = options.relayEventManager;\n        this._walletLinkAnalytics = options.walletLinkAnalytics\n            ? options.walletLinkAnalytics\n            : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n        const chainId = this.getChainId();\n        const chainIdStr = util_1.prepend0x(chainId.toString(16));\n        // indicate that we've connected, for EIP-1193 compliance\n        this.emit(\"connect\", { chainIdStr });\n        const cachedAddresses = this._storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n        if (cachedAddresses) {\n            const addresses = cachedAddresses.split(\" \");\n            if (addresses[0] !== \"\") {\n                this._addresses = addresses;\n                this.emit(\"accountsChanged\", addresses);\n            }\n        }\n        this._subscriptionManager.events.on(\"notification\", (notification) => {\n            this.emit(\"message\", {\n                type: notification.method,\n                data: notification.params\n            });\n        });\n        if (this._addresses.length > 0) {\n            this.initializeRelay();\n        }\n    }\n    get selectedAddress() {\n        return this._addresses[0] || undefined;\n    }\n    get networkVersion() {\n        return this.getChainId().toString(10);\n    }\n    get chainId() {\n        return util_1.prepend0x(this.getChainId().toString(16));\n    }\n    get isWalletLink() {\n        return true;\n    }\n    /**\n     * Some DApps (i.e. Alpha Homora) seem to require the window.ethereum object return\n     * true for this method.\n     */\n    get isMetaMask() {\n        return this._overrideIsMetaMask;\n    }\n    get host() {\n        return this._jsonRpcUrl;\n    }\n    get connected() {\n        return true;\n    }\n    isConnected() {\n        return true;\n    }\n    // @ts-ignore\n    setProviderInfo(jsonRpcUrl, chainId) {\n        if (this.isChainOverridden)\n            return;\n        this.updateProviderInfo(jsonRpcUrl, this.getChainId(), false);\n    }\n    updateProviderInfo(jsonRpcUrl, chainId, fromRelay) {\n        const hasChainSwitched = this._storage.getItem(HAS_CHAIN_BEEN_SWITCHED_KEY) === \"true\";\n        if (hasChainSwitched && fromRelay)\n            return;\n        if (fromRelay) {\n            this.isChainOverridden = true;\n        }\n        this._jsonRpcUrl = jsonRpcUrl;\n        // emit chainChanged event if necessary\n        const originalChainId = this.getChainId();\n        this._storage.setItem(DEFAULT_CHAIN_ID_KEY, chainId.toString(10));\n        const chainChanged = util_1.ensureIntNumber(chainId) !== originalChainId;\n        if (chainChanged || !this.hasMadeFirstChainChangedEmission) {\n            this.emit(\"chainChanged\", this.getChainId());\n            this.hasMadeFirstChainChangedEmission = true;\n        }\n    }\n    async switchEthereumChain(rpcUrl, chainId) {\n        if (util_1.ensureIntNumber(chainId) === this.getChainId()) {\n            return;\n        }\n        const relay = await this.initializeRelay();\n        const res = await relay.switchEthereumChain(chainId.toString(10)).promise;\n        if (res.result === true) {\n            this._storage.setItem(HAS_CHAIN_BEEN_SWITCHED_KEY, \"true\");\n            this.updateProviderInfo(rpcUrl, chainId, false);\n        }\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.initializeRelay().then(relay => relay.setAppInfo(appName, appLogoUrl));\n    }\n    async enable() {\n        this._walletLinkAnalytics.sendEvent(init_1.EVENTS.ETH_ACCOUNTS_STATE, {\n            method: \"provider::enable\",\n            addresses_length: this._addresses.length,\n            sessionIdHash: this._relay ? Session_1.Session.hash(this._relay.session.id) : null\n        });\n        if (this._addresses.length > 0) {\n            return this._addresses;\n        }\n        return await this._send(JSONRPC_1.JSONRPCMethod.eth_requestAccounts);\n    }\n    close() {\n        this.initializeRelay().then(relay => relay.resetAndReload());\n    }\n    send(requestOrMethod, callbackOrParams) {\n        // send<T>(method, params): Promise<T>\n        if (typeof requestOrMethod === \"string\") {\n            const method = requestOrMethod;\n            const params = Array.isArray(callbackOrParams)\n                ? callbackOrParams\n                : callbackOrParams !== undefined\n                    ? [callbackOrParams]\n                    : [];\n            const request = {\n                jsonrpc: \"2.0\",\n                id: 0,\n                method,\n                params\n            };\n            return this._sendRequestAsync(request).then(res => res.result);\n        }\n        // send(JSONRPCRequest | JSONRPCRequest[], callback): void\n        if (typeof callbackOrParams === \"function\") {\n            const request = requestOrMethod;\n            const callback = callbackOrParams;\n            return this._sendAsync(request, callback);\n        }\n        // send(JSONRPCRequest[]): JSONRPCResponse[]\n        if (Array.isArray(requestOrMethod)) {\n            const requests = requestOrMethod;\n            return requests.map(r => this._sendRequest(r));\n        }\n        // send(JSONRPCRequest): JSONRPCResponse\n        const req = requestOrMethod;\n        return this._sendRequest(req);\n    }\n    sendAsync(request, callback) {\n        if (typeof callback !== \"function\") {\n            throw new Error(\"callback is required\");\n        }\n        // send(JSONRPCRequest[], callback): void\n        if (Array.isArray(request)) {\n            const arrayCb = callback;\n            this._sendMultipleRequestsAsync(request)\n                .then(responses => arrayCb(null, responses))\n                .catch(err => arrayCb(err, null));\n            return;\n        }\n        // send(JSONRPCRequest, callback): void\n        const cb = callback;\n        this._sendRequestAsync(request)\n            .then(response => cb(null, response))\n            .catch(err => cb(err, null));\n    }\n    async request(args) {\n        if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n            throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                message: \"Expected a single, non-array, object argument.\",\n                data: args\n            });\n        }\n        const { method, params } = args;\n        if (typeof method !== \"string\" || method.length === 0) {\n            throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                message: \"'args.method' must be a non-empty string.\",\n                data: args\n            });\n        }\n        if (params !== undefined &&\n            !Array.isArray(params) &&\n            (typeof params !== \"object\" || params === null)) {\n            throw eth_rpc_errors_1.ethErrors.rpc.invalidRequest({\n                message: \"'args.params' must be an object or array if provided.\",\n                data: args\n            });\n        }\n        const newParams = params === undefined ? [] : params;\n        // WalletLink Requests\n        const id = this._relayEventManager.makeRequestId();\n        const result = await this._sendRequestAsync({\n            method,\n            params: newParams,\n            jsonrpc: \"2.0\",\n            id\n        });\n        return result.result;\n    }\n    async scanQRCode(match) {\n        const relay = await this.initializeRelay();\n        const res = await relay.scanQRCode(util_1.ensureRegExpString(match)).promise;\n        if (typeof res.result !== \"string\") {\n            throw new Error(\"result was not a string\");\n        }\n        return res.result;\n    }\n    async arbitraryRequest(data) {\n        const relay = await this.initializeRelay();\n        const res = await relay.arbitraryRequest(data).promise;\n        if (typeof res.result !== \"string\") {\n            throw new Error(\"result was not a string\");\n        }\n        return res.result;\n    }\n    supportsSubscriptions() {\n        return false;\n    }\n    subscribe() {\n        throw new Error(\"Subscriptions are not supported\");\n    }\n    unsubscribe() {\n        throw new Error(\"Subscriptions are not supported\");\n    }\n    disconnect() {\n        return true;\n    }\n    _sendRequest(request) {\n        const response = {\n            jsonrpc: \"2.0\",\n            id: request.id\n        };\n        const { method } = request;\n        response.result = this._handleSynchronousMethods(request);\n        if (response.result === undefined) {\n            throw new Error(`WalletLink does not support calling ${method} synchronously without ` +\n                `a callback. Please provide a callback parameter to call ${method} ` +\n                `asynchronously.`);\n        }\n        return response;\n    }\n    _setAddresses(addresses) {\n        if (!Array.isArray(addresses)) {\n            throw new Error(\"addresses is not an array\");\n        }\n        const newAddresses = addresses.map(address => util_1.ensureAddressString(address));\n        if (JSON.stringify(newAddresses) === JSON.stringify(this._addresses)) {\n            return;\n        }\n        this._addresses = newAddresses;\n        this.emit(\"accountsChanged\", this._addresses);\n        this._storage.setItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY, newAddresses.join(\" \"));\n        window.dispatchEvent(new CustomEvent(\"walletlink:addresses\", { detail: this._addresses }));\n    }\n    _sendRequestAsync(request) {\n        return new Promise((resolve, reject) => {\n            try {\n                const syncResult = this._handleSynchronousMethods(request);\n                if (syncResult !== undefined) {\n                    return resolve({\n                        jsonrpc: \"2.0\",\n                        id: request.id,\n                        result: syncResult\n                    });\n                }\n                const filterPromise = this._handleAsynchronousFilterMethods(request);\n                if (filterPromise !== undefined) {\n                    filterPromise\n                        .then(res => resolve(Object.assign(Object.assign({}, res), { id: request.id })))\n                        .catch(err => reject(err));\n                    return;\n                }\n                const subscriptionPromise = this._handleSubscriptionMethods(request);\n                if (subscriptionPromise !== undefined) {\n                    subscriptionPromise\n                        .then(res => resolve({\n                        jsonrpc: \"2.0\",\n                        id: request.id,\n                        result: res.result\n                    }))\n                        .catch(err => reject(err));\n                    return;\n                }\n            }\n            catch (err) {\n                return reject(err);\n            }\n            this._handleAsynchronousMethods(request)\n                .then(res => resolve(Object.assign(Object.assign({}, res), { id: request.id })))\n                .catch(err => reject(err));\n        });\n    }\n    _sendMultipleRequestsAsync(requests) {\n        return Promise.all(requests.map(r => this._sendRequestAsync(r)));\n    }\n    _handleSynchronousMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_accounts:\n                return this._eth_accounts();\n            case JSONRPC_1.JSONRPCMethod.eth_coinbase:\n                return this._eth_coinbase();\n            case JSONRPC_1.JSONRPCMethod.eth_uninstallFilter:\n                return this._eth_uninstallFilter(params);\n            case JSONRPC_1.JSONRPCMethod.net_version:\n                return this._net_version();\n            case JSONRPC_1.JSONRPCMethod.eth_chainId:\n                return this._eth_chainId();\n            default:\n                return undefined;\n        }\n    }\n    _handleAsynchronousMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_requestAccounts:\n                return this._eth_requestAccounts();\n            case JSONRPC_1.JSONRPCMethod.eth_sign:\n                return this._eth_sign(params);\n            case JSONRPC_1.JSONRPCMethod.eth_ecRecover:\n                return this._eth_ecRecover(params);\n            case JSONRPC_1.JSONRPCMethod.personal_sign:\n                return this._personal_sign(params);\n            case JSONRPC_1.JSONRPCMethod.personal_ecRecover:\n                return this._personal_ecRecover(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTransaction:\n                return this._eth_signTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_sendRawTransaction:\n                return this._eth_sendRawTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_sendTransaction:\n                return this._eth_sendTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v1:\n                return this._eth_signTypedData_v1(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v2:\n                return this._throwUnsupportedMethodError();\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v3:\n                return this._eth_signTypedData_v3(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v4:\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData:\n                return this._eth_signTypedData_v4(params);\n            case JSONRPC_1.JSONRPCMethod.walletlink_arbitrary:\n                return this._walletlink_arbitrary(params);\n            case JSONRPC_1.JSONRPCMethod.wallet_addEthereumChain:\n                return this._wallet_addEthereumChain(params);\n            case JSONRPC_1.JSONRPCMethod.wallet_switchEthereumChain:\n                return this._wallet_switchEthereumChain(params);\n        }\n        if (!this._jsonRpcUrl)\n            throw Error(\"Error: No jsonRpcUrl provided\");\n        return window\n            .fetch(this._jsonRpcUrl, {\n            method: \"POST\",\n            body: JSON.stringify(request),\n            mode: \"cors\",\n            headers: { \"Content-Type\": \"application/json\" }\n        })\n            .then(res => res.json())\n            .then(json => {\n            if (!json) {\n                throw eth_rpc_errors_1.ethErrors.rpc.parse({});\n            }\n            const response = json;\n            const { error } = response;\n            if (error) {\n                throw eth_rpc_errors_1.serializeError(error);\n            }\n            return response;\n        });\n    }\n    _handleAsynchronousFilterMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_newFilter:\n                return this._eth_newFilter(params);\n            case JSONRPC_1.JSONRPCMethod.eth_newBlockFilter:\n                return this._eth_newBlockFilter();\n            case JSONRPC_1.JSONRPCMethod.eth_newPendingTransactionFilter:\n                return this._eth_newPendingTransactionFilter();\n            case JSONRPC_1.JSONRPCMethod.eth_getFilterChanges:\n                return this._eth_getFilterChanges(params);\n            case JSONRPC_1.JSONRPCMethod.eth_getFilterLogs:\n                return this._eth_getFilterLogs(params);\n        }\n        return undefined;\n    }\n    _handleSubscriptionMethods(request) {\n        switch (request.method) {\n            case JSONRPC_1.JSONRPCMethod.eth_subscribe:\n            case JSONRPC_1.JSONRPCMethod.eth_unsubscribe:\n                return this._subscriptionManager.handleRequest(request);\n        }\n        return undefined;\n    }\n    _isKnownAddress(addressString) {\n        try {\n            const address = util_1.ensureAddressString(addressString);\n            return this._addresses.includes(address);\n        }\n        catch (_a) { }\n        return false;\n    }\n    _ensureKnownAddress(addressString) {\n        if (!this._isKnownAddress(addressString)) {\n            throw new Error(\"Unknown Ethereum address\");\n        }\n    }\n    _prepareTransactionParams(tx) {\n        const fromAddress = tx.from\n            ? util_1.ensureAddressString(tx.from)\n            : this.selectedAddress;\n        if (!fromAddress) {\n            throw new Error(\"Ethereum address is unavailable\");\n        }\n        this._ensureKnownAddress(fromAddress);\n        const toAddress = tx.to ? util_1.ensureAddressString(tx.to) : null;\n        const weiValue = tx.value != null ? util_1.ensureBN(tx.value) : new bn_js_1.default(0);\n        const data = tx.data ? util_1.ensureBuffer(tx.data) : Buffer.alloc(0);\n        const nonce = tx.nonce != null ? util_1.ensureIntNumber(tx.nonce) : null;\n        const gasPriceInWei = tx.gasPrice != null ? util_1.ensureBN(tx.gasPrice) : null;\n        const maxFeePerGas = tx.maxFeePerGas != null ? util_1.ensureBN(tx.maxFeePerGas) : null;\n        const maxPriorityFeePerGas = tx.maxPriorityFeePerGas != null ? util_1.ensureBN(tx.maxPriorityFeePerGas) : null;\n        const gasLimit = tx.gas != null ? util_1.ensureBN(tx.gas) : null;\n        const chainId = this.getChainId();\n        return {\n            fromAddress,\n            toAddress,\n            weiValue,\n            data,\n            nonce,\n            gasPriceInWei,\n            maxFeePerGas,\n            maxPriorityFeePerGas,\n            gasLimit,\n            chainId\n        };\n    }\n    _requireAuthorization() {\n        if (this._addresses.length === 0) {\n            throw eth_rpc_errors_1.ethErrors.provider.unauthorized({});\n        }\n    }\n    _throwUnsupportedMethodError() {\n        throw eth_rpc_errors_1.ethErrors.provider.unsupportedMethod({});\n    }\n    async _signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        this._ensureKnownAddress(address);\n        try {\n            const relay = await this.initializeRelay();\n            const res = await relay.signEthereumMessage(message, address, addPrefix, typedDataJson).promise;\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied message signature\");\n            }\n            throw err;\n        }\n    }\n    async _ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        const relay = await this.initializeRelay();\n        const res = await relay.ethereumAddressFromSignedMessage(message, signature, addPrefix).promise;\n        return { jsonrpc: \"2.0\", id: 0, result: res.result };\n    }\n    _eth_accounts() {\n        return this._addresses;\n    }\n    _eth_coinbase() {\n        return this.selectedAddress || null;\n    }\n    _net_version() {\n        return this.getChainId().toString(10);\n    }\n    _eth_chainId() {\n        return util_1.hexStringFromIntNumber(this.getChainId());\n    }\n    getChainId() {\n        const chainIdStr = this._storage.getItem(DEFAULT_CHAIN_ID_KEY) || \"1\";\n        const chainId = parseInt(chainIdStr, 10);\n        return util_1.ensureIntNumber(chainId);\n    }\n    async _eth_requestAccounts() {\n        this._walletLinkAnalytics.sendEvent(init_1.EVENTS.ETH_ACCOUNTS_STATE, {\n            method: \"provider::_eth_requestAccounts\",\n            addresses_length: this._addresses.length,\n            sessionIdHash: this._relay ? Session_1.Session.hash(this._relay.session.id) : null\n        });\n        if (this._addresses.length > 0) {\n            return Promise.resolve({\n                jsonrpc: \"2.0\",\n                id: 0,\n                result: this._addresses\n            });\n        }\n        let res;\n        try {\n            const relay = await this.initializeRelay();\n            res = await relay.requestEthereumAccounts().promise;\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied account authorization\");\n            }\n            throw err;\n        }\n        if (!res.result) {\n            throw new Error(\"accounts received is empty\");\n        }\n        this._setAddresses(res.result);\n        return { jsonrpc: \"2.0\", id: 0, result: this._addresses };\n    }\n    _eth_sign(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const message = util_1.ensureBuffer(params[1]);\n        return this._signEthereumMessage(message, address, false);\n    }\n    _eth_ecRecover(params) {\n        const message = util_1.ensureBuffer(params[0]);\n        const signature = util_1.ensureBuffer(params[1]);\n        return this._ethereumAddressFromSignedMessage(message, signature, false);\n    }\n    _personal_sign(params) {\n        this._requireAuthorization();\n        const message = util_1.ensureBuffer(params[0]);\n        const address = util_1.ensureAddressString(params[1]);\n        return this._signEthereumMessage(message, address, true);\n    }\n    _personal_ecRecover(params) {\n        const message = util_1.ensureBuffer(params[0]);\n        const signature = util_1.ensureBuffer(params[1]);\n        return this._ethereumAddressFromSignedMessage(message, signature, true);\n    }\n    async _eth_signTransaction(params) {\n        this._requireAuthorization();\n        const tx = this._prepareTransactionParams(params[0] || {});\n        try {\n            const relay = await this.initializeRelay();\n            const res = await relay.signEthereumTransaction(tx).promise;\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied transaction signature\");\n            }\n            throw err;\n        }\n    }\n    async _eth_sendRawTransaction(params) {\n        const signedTransaction = util_1.ensureBuffer(params[0]);\n        const relay = await this.initializeRelay();\n        const res = await relay.submitEthereumTransaction(signedTransaction, this.getChainId()).promise;\n        return { jsonrpc: \"2.0\", id: 0, result: res.result };\n    }\n    async _eth_sendTransaction(params) {\n        this._requireAuthorization();\n        const tx = this._prepareTransactionParams(params[0] || {});\n        try {\n            const relay = await this.initializeRelay();\n            const res = await relay.signAndSubmitEthereumTransaction(tx).promise;\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied transaction signature\");\n            }\n            throw err;\n        }\n    }\n    async _eth_signTypedData_v1(params) {\n        this._requireAuthorization();\n        const typedData = util_1.ensureParsedJSONObject(params[0]);\n        const address = util_1.ensureAddressString(params[1]);\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedDataLegacy({ data: typedData });\n        const typedDataJSON = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJSON);\n    }\n    async _eth_signTypedData_v3(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const typedData = util_1.ensureParsedJSONObject(params[1]);\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedData_v3({ data: typedData });\n        const typedDataJSON = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJSON);\n    }\n    async _eth_signTypedData_v4(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const typedData = util_1.ensureParsedJSONObject(params[1]);\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedData_v4({ data: typedData });\n        const typedDataJSON = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJSON);\n    }\n    async _walletlink_arbitrary(params) {\n        const data = params[0];\n        if (typeof data !== \"string\") {\n            throw new Error(\"parameter must be a string\");\n        }\n        const result = await this.arbitraryRequest(data);\n        return { jsonrpc: \"2.0\", id: 0, result };\n    }\n    async _wallet_addEthereumChain(params) {\n        const request = (params[0]);\n        const chainIdNumber = parseInt(request.chainId, 16);\n        const ethereumChain = EthereumChain_1.EthereumChain.fromChainId(BigInt(chainIdNumber));\n        if (ethereumChain === undefined) {\n            return { jsonrpc: '2.0', id: 0, error: { code: 2, message: `chainId ${request.chainId} not supported` } };\n        }\n        const rpcUrl = EthereumChain_1.EthereumChain.rpcUrl(ethereumChain);\n        // @ts-ignore\n        await this.switchEthereumChain(rpcUrl, parseInt(request.chainId, 16));\n        return { jsonrpc: '2.0', id: 0, result: null };\n    }\n    async _wallet_switchEthereumChain(params) {\n        const request = (params[0]);\n        const chainIdNumber = parseInt(request.chainId, 16);\n        const ethereumChain = EthereumChain_1.EthereumChain.fromChainId(BigInt(chainIdNumber));\n        if (ethereumChain === undefined) {\n            return { jsonrpc: '2.0', id: 0, error: { code: 2, message: `chainId ${request.chainId} not supported` } };\n        }\n        const rpcUrl = EthereumChain_1.EthereumChain.rpcUrl(ethereumChain);\n        // @ts-ignore\n        await this.switchEthereumChain(rpcUrl, parseInt(request.chainId, 16));\n        return { jsonrpc: \"2.0\", id: 0, result: null };\n    }\n    _eth_uninstallFilter(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.uninstallFilter(filterId);\n    }\n    async _eth_newFilter(params) {\n        const param = params[0];\n        const filterId = await this._filterPolyfill.newFilter(param);\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    async _eth_newBlockFilter() {\n        const filterId = await this._filterPolyfill.newBlockFilter();\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    async _eth_newPendingTransactionFilter() {\n        const filterId = await this._filterPolyfill.newPendingTransactionFilter();\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    _eth_getFilterChanges(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.getFilterChanges(filterId);\n    }\n    _eth_getFilterLogs(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.getFilterLogs(filterId);\n    }\n    initializeRelay() {\n        if (this._relay) {\n            return Promise.resolve(this._relay);\n        }\n        return this._relayProvider().then(relay => {\n            relay.setAccountsCallback((accounts) => this._setAddresses(accounts));\n            relay.setChainIdCallback((chainId) => {\n                this.updateProviderInfo(this._jsonRpcUrl, parseInt(chainId, 10), true);\n            });\n            relay.setJsonRpcUrlCallback((jsonRpcUrl) => {\n                this.updateProviderInfo(jsonRpcUrl, this.getChainId(), true);\n            });\n            this._relay = relay;\n            return relay;\n        });\n    }\n}\nexports.WalletLinkProvider = WalletLinkProvider;\n"]},"metadata":{},"sourceType":"script"}