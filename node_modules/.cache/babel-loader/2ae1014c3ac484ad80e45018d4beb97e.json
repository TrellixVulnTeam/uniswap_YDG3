{"ast":null,"code":"import contenthashToUri from './contenthashToUri';\nimport { parseENSAddress } from './parseENSAddress';\nimport uriToHttp from './uriToHttp'; // lazily get the validator the first time it is used\n\nconst getTokenListValidator = (() => {\n  let tokenListValidator;\n  return () => {\n    if (!tokenListValidator) {\n      tokenListValidator = new Promise(async resolve => {\n        const [ajv, schema] = await Promise.all([import('ajv'), import('@uniswap/token-lists/src/tokenlist.schema.json')]);\n        const validator = new ajv.default({\n          allErrors: true\n        }).compile(schema);\n        resolve(validator);\n      });\n    }\n\n    return tokenListValidator;\n  };\n})();\n/**\n * Contains the logic for resolving a list URL to a validated token list\n * @param listUrl list url\n * @param resolveENSContentHash resolves an ens name to a contenthash\n */\n\n\nexport default async function getTokenList(listUrl, resolveENSContentHash) {\n  const tokenListValidator = getTokenListValidator();\n  const parsedENS = parseENSAddress(listUrl);\n  let urls;\n\n  if (parsedENS) {\n    var _parsedENS$ensPath;\n\n    let contentHashUri;\n\n    try {\n      contentHashUri = await resolveENSContentHash(parsedENS.ensName);\n    } catch (error) {\n      console.debug(`Failed to resolve ENS name: ${parsedENS.ensName}`, error);\n      throw new Error(`Failed to resolve ENS name: ${parsedENS.ensName}`);\n    }\n\n    let translatedUri;\n\n    try {\n      translatedUri = contenthashToUri(contentHashUri);\n    } catch (error) {\n      console.debug('Failed to translate contenthash to URI', contentHashUri);\n      throw new Error(`Failed to translate contenthash to URI: ${contentHashUri}`);\n    }\n\n    urls = uriToHttp(`${translatedUri}${(_parsedENS$ensPath = parsedENS.ensPath) !== null && _parsedENS$ensPath !== void 0 ? _parsedENS$ensPath : ''}`);\n  } else {\n    urls = uriToHttp(listUrl);\n  }\n\n  for (let i = 0; i < urls.length; i++) {\n    const url = urls[i];\n    const isLast = i === urls.length - 1;\n    let response;\n\n    try {\n      response = await fetch(url, {\n        credentials: 'omit'\n      });\n    } catch (error) {\n      console.debug('Failed to fetch list', listUrl, error);\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`);\n      continue;\n    }\n\n    if (!response.ok) {\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`);\n      continue;\n    }\n\n    const [json, validator] = await Promise.all([response.json(), tokenListValidator]);\n\n    if (!validator(json)) {\n      var _validator$errors$red, _validator$errors;\n\n      const validationErrors = (_validator$errors$red = (_validator$errors = validator.errors) === null || _validator$errors === void 0 ? void 0 : _validator$errors.reduce((memo, error) => {\n        var _error$message;\n\n        const add = `${error.dataPath} ${(_error$message = error.message) !== null && _error$message !== void 0 ? _error$message : ''}`;\n        return memo.length > 0 ? `${memo}; ${add}` : `${add}`;\n      }, '')) !== null && _validator$errors$red !== void 0 ? _validator$errors$red : 'unknown error';\n      throw new Error(`Token list failed validation: ${validationErrors}`);\n    }\n\n    return json;\n  }\n\n  throw new Error('Unrecognized list URL protocol.');\n}","map":{"version":3,"sources":["/Users/safahi/Downloads/interface-4.30.1/src/utils/getTokenList.ts"],"names":["contenthashToUri","parseENSAddress","uriToHttp","getTokenListValidator","tokenListValidator","Promise","resolve","ajv","schema","all","validator","default","allErrors","compile","getTokenList","listUrl","resolveENSContentHash","parsedENS","urls","contentHashUri","ensName","error","console","debug","Error","translatedUri","ensPath","i","length","url","isLast","response","fetch","credentials","ok","json","validationErrors","errors","reduce","memo","add","dataPath","message"],"mappings":"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","sourcesContent":["import { TokenList } from '@uniswap/token-lists'\nimport { ValidateFunction } from 'ajv'\n\nimport contenthashToUri from './contenthashToUri'\nimport { parseENSAddress } from './parseENSAddress'\nimport uriToHttp from './uriToHttp'\n\n// lazily get the validator the first time it is used\nconst getTokenListValidator = (() => {\n  let tokenListValidator: Promise<ValidateFunction>\n  return () => {\n    if (!tokenListValidator) {\n      tokenListValidator = new Promise<ValidateFunction>(async (resolve) => {\n        const [ajv, schema] = await Promise.all([\n          import('ajv'),\n          import('@uniswap/token-lists/src/tokenlist.schema.json'),\n        ])\n        const validator = new ajv.default({ allErrors: true }).compile(schema)\n        resolve(validator)\n      })\n    }\n    return tokenListValidator\n  }\n})()\n\n/**\n * Contains the logic for resolving a list URL to a validated token list\n * @param listUrl list url\n * @param resolveENSContentHash resolves an ens name to a contenthash\n */\nexport default async function getTokenList(\n  listUrl: string,\n  resolveENSContentHash: (ensName: string) => Promise<string>\n): Promise<TokenList> {\n  const tokenListValidator = getTokenListValidator()\n  const parsedENS = parseENSAddress(listUrl)\n  let urls: string[]\n  if (parsedENS) {\n    let contentHashUri\n    try {\n      contentHashUri = await resolveENSContentHash(parsedENS.ensName)\n    } catch (error) {\n      console.debug(`Failed to resolve ENS name: ${parsedENS.ensName}`, error)\n      throw new Error(`Failed to resolve ENS name: ${parsedENS.ensName}`)\n    }\n    let translatedUri\n    try {\n      translatedUri = contenthashToUri(contentHashUri)\n    } catch (error) {\n      console.debug('Failed to translate contenthash to URI', contentHashUri)\n      throw new Error(`Failed to translate contenthash to URI: ${contentHashUri}`)\n    }\n    urls = uriToHttp(`${translatedUri}${parsedENS.ensPath ?? ''}`)\n  } else {\n    urls = uriToHttp(listUrl)\n  }\n  for (let i = 0; i < urls.length; i++) {\n    const url = urls[i]\n    const isLast = i === urls.length - 1\n    let response\n    try {\n      response = await fetch(url, { credentials: 'omit' })\n    } catch (error) {\n      console.debug('Failed to fetch list', listUrl, error)\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\n      continue\n    }\n\n    if (!response.ok) {\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\n      continue\n    }\n\n    const [json, validator] = await Promise.all([response.json(), tokenListValidator])\n    if (!validator(json)) {\n      const validationErrors: string =\n        validator.errors?.reduce<string>((memo, error) => {\n          const add = `${error.dataPath} ${error.message ?? ''}`\n          return memo.length > 0 ? `${memo}; ${add}` : `${add}`\n        }, '') ?? 'unknown error'\n      throw new Error(`Token list failed validation: ${validationErrors}`)\n    }\n    return json\n  }\n  throw new Error('Unrecognized list URL protocol.')\n}\n"]},"metadata":{},"sourceType":"module"}